import{E as t}from"./evt-20927eae.js";import{e,g as n}from"./dom-utils-417838ed.js";import{L as o,h as l,T as i,u as r}from"./timer-562516a7.js";import{initFocusHidingEvents as c}from"./focus-utils-1ab9273a.js";import{d as a}from"./disposable-35c3c450.js";import"./dom-a06f5987.js";import"./touch-2ca1b361.js";function s(n,a,s,h){if(!(n=e(n)))return Promise.reject("failed");function f(t){const e=(n.dayCells||(n.dayCells=n.querySelectorAll(".dxbs-day")),n.dayCells);for(let n,o=0;n=e[o];o++){const e=n.getBoundingClientRect();if(e.top<=t.y&&t.y<e.bottom&&e.left<=t.x&&t.x<e.right)return n}return null}function m(t){if(l("TouchStart")||!t.srcElement)return;const e=d(t.srcElement);e&&(n.inSelectionMode=!0,n.firstDate=u(e))}function g(t){n.inSelectionMode&&(n.throttledDrag||(n.throttledDrag=i.throttle((t=>{const e=f({x:t.clientX,y:t.clientY});if(e){const o=u(e);if(!o||!n.firstDate)return;n.lastDate?h.invokeMethodAsync("ChangeSelectionRange",o):(h.invokeMethodAsync("StartSelectionRange",n.firstDate,!t.ctrlKey),n.lastDate=o)}}),20)),n.throttledDrag(t))}function y(){n.inSelectionMode&&n.lastDate&&h.invokeMethodAsync("EndSelectionRange",!1),n.firstDate=null,n.lastDate=null,n.inSelectionMode=!1}function E(){r((()=>{}),"TouchStart",300,!0)}function v(t){if(!t.srcElement)return;const e=d(t.srcElement);if(e){n.inSelectionMode=!0;const t=u(e);n.lastDate=t,h.invokeMethodAsync("StartSelectionRange",t,!1)}}function S(e){if(!n.inSelectionMode)return;const o=f({x:e.touches[0].clientX,y:e.touches[0].clientY});if(o){const t=u(o);t&&n.lastDate!==t&&h.invokeMethodAsync("ChangeSelectionRange",t)}t.preventEventAndBubble(e)}function p(e){n.inSelectionMode&&(h.invokeMethodAsync("EndSelectionRange",!0),t.preventEventAndBubble(e)),n.inSelectionMode=!1}if(n.dayCells=null,function(t){o.attachEventToElement(t,"touchstart",E,null),o.attachEventToElement(t,"touchmove",S,null),o.attachEventToElement(t,"touchend",p,null),o.attachLongTabEventToElement(t,v),o.attachEventToElement(t,"mousedown",m,null),o.attachEventToElement(t,"mousemove",g,null),o.attachEventToElement(t,"mouseup",y,null)}(n),c(n.querySelector(".card-header.btn-group")),!s){a.style.width="",a.style.height="";const t=a.getBoundingClientRect();a.style.width=t.width+"px",a.style.height=t.height+"px"}return Promise.resolve("ok")}function u(t){return new Date(Number(t.getAttribute("data-date")))}function d(t){return n(t,"dxbs-day")}function h(t){return(t=e(t))&&(a(t),a(t.querySelector(".card-header.btn-group"))),Promise.resolve("ok")}const f={init:s,dispose:h};export default f;export{h as dispose,s as init};
