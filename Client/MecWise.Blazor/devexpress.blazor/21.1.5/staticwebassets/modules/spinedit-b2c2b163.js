import{k as e}from"./key-643beca5.js";import{d as t,r as n}from"./disposable-35c3c450.js";import{e as s,g as a}from"./dom-utils-417838ed.js";import"./dom-a06f5987.js";function o(e,t){e&&(e.dataset.previousValue=t)}function r(o,r,i){o=s(o);const d=a(o,"dxbs-spin-edit");if(!o)return Promise.reject("failed");t(d);const l=e=>{var t,n,s;r.maskMode||(t=r.decimalSeparator,n=r.needExponentialView,s=o,e=>{let a=s.dataset.selectionStartBeforePaste?s.value.trim():s.value,o=/^-?(\d)*$/;t&&(a=a.replace(/[.|,]/g,t),o=n?/^-?(\d+|[,.]\d+|\d+[,.]\d+|\d+[,.]|[,.])?([eE]?[+-]?(\d)*)?$/:/^-?(\d+|[,.]\d+|\d+[,.]\d+|\d+[,.]|[,.])?$/);let r=s.selectionStart,i=s.selectionEnd;o.test(a)?(a!==s.value&&(s.value=a),s.dataset.previousValue=a):(s.dataset.selectionStartBeforePaste&&s.dataset.selectionEndBeforePaste?(r=parseInt(s.dataset.selectionStartBeforePaste),i=parseInt(s.dataset.selectionEndBeforePaste)):r&&i&&s.dataset.previousValue&&(r--,i+=s.dataset.previousValue.length-a.length),s.value=s.dataset.previousValue||""),s.dataset.selectionStartBeforePaste&&(s.removeAttribute("data-selection-start-before-paste"),s.removeAttribute("data-selection-end-before-paste")),s.selectionStart=r,s.selectionEnd=i})(e)},u=e=>{var t;r.maskMode||(t=o,e=>{t.dataset.selectionStartBeforePaste=String(t.selectionStart),t.dataset.selectionEndBeforePaste=String(t.selectionEnd)})(e)},c=t=>{if(function(t){return t.keyCode===e.KeyCode.Up||t.keyCode===e.KeyCode.Down}(t)){if(t.preventDefault(),t.repeat)return;const n=o.getAttribute("dx-mask-value");i.invokeMethodAsync("OnKeyDown",t.keyCode===e.KeyCode.Up,null==n?o.value:n)}},v=e=>function(e,t,n,s){return!(!function(e){return!e.disabled&&!e.readOnly}(n)||document.activeElement!==n)&&(e.preventDefault(),s.invokeMethodAsync("OnMouseWheel",e.deltaY<0),!1)}(e,0,o,i);return o.addEventListener("input",l),o.addEventListener("paste",u),o.addEventListener("keydown",c),d.addEventListener("wheel",v,{passive:!1}),n(d,(function(){o.removeEventListener("input",l),o.removeEventListener("keydown",c),o.removeEventListener("paste",u),d.removeEventListener("wheel",v)})),Promise.resolve("ok")}function i(e,t){d(e).then((e=>{e&&t.invokeMethodAsync("FocusLost")}))}function d(e){return new Promise(((t,n)=>{let s=document.activeElement;for(;null!==s&&s!==e;)s=s.parentElement;t(null!==s)}))}function l(e){return(e=s(e))&&t(e),Promise.resolve("ok")}const u={init:r,dispose:l,setPreviousValue:o,checkFocusedState:i,isFocusInsideSpinEdit:d};export default u;export{i as checkFocusedState,l as dispose,r as init,d as isFocusInsideSpinEdit,o as setPreviousValue};
