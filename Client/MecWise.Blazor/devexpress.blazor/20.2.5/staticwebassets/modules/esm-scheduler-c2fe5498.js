import{B as t}from"./esm-chunk-d81494b9.js";import"./esm-chunk-a2731447.js";import{getAbsoluteX as e,getAbsoluteY as n,setAbsoluteX as i,setAbsoluteY as o,removeClassNameFromElement as r,addClassNameToElement as s,getDocumentScrollLeft as a,getDocumentScrollTop as l,getDocumentClientHeight as c,getDocumentClientWidth as u,unsubscribeElement as f,ensureElement as p,getParentByClassName as h,elementHasCssClass as m,subscribeElementContentSize as d}from"./esm-dom-utils-0e4190ff.js";import{a as g,p as y,d as v}from"./esm-chunk-9c16a801.js";import{d as T,r as A}from"./esm-chunk-f1e43abb.js";import{L as C,h as S,u as x,c as I,T as w}from"./esm-chunk-1b6abd73.js";import{T as b}from"./esm-chunk-66f169d2.js";const D={showCallout:!0,showTitle:!1,position:"right",className:"",classNames:{sysClassName:"dx-hint",contentElementClassName:"dxh-content",calloutElementClassName:"arrow",titleElementClassName:"dxh-title"},allowFlip:!0,allowShift:!0,offset:4};function E(t,r,s){s||(s=D),r.style.visibility="hidden",r.style.display="block",function(t,r){const s=e(t),a=n(t);i(r,s),o(r,a)}(t,r),H.updatePosition(t,r,s),r.style.visibility=""}const H=function(){function t(t){return"bs-popover-"+t.toLowerCase()}function e(e,n,i){const o=z.set(e,n,i);!function(e,n,i){const o=t(n),a=t(i);r(e,o),s(e,a)}(n,i.position,o.flipPosition),function(t,e,n){const i=H.getCalloutElement(t,e.classNames);if(!i)return;const o=!("left"===(r=e.position)||"right"===r);var r;const s=o?t.offsetWidth:t.offsetHeight;let a=s/2-(o?n.x:n.y);a=function(t,e){const n={min:15,max:e-15},i=t<n.min,o=t>n.max;o&&(t=n.max);i&&(t=n.min);t+="px",i&&o&&(t="50%");return t}(a,s),i.style[o?"left":"top"]=a}(n,i,o.shift)}return{getCalloutElement:function(t,e){return t?t.getElementsByClassName(e.calloutElementClassName)[0]:null},updatePosition:function(t,n,i){let o=10,r=!1;do{const s={w:n.offsetWidth,h:n.offsetHeight};e(t,n,i),r=s.w!==n.offsetWidth||s.h!==n.offsetHeight,o--}while(r&&o>0)}}}();function O(i,o,r){this.targetElement=i,this.hintElement=o,this.options=r,this.position=r.position,this.calloutSize={width:0,height:0};const s=H.getCalloutElement(o,r.classNames);function f(i,o,r,s,f){this.location=0,this.screen={min:0,max:0},this.screen.min=f?a():l();const p=t.WebKitTouchUI?window.innerWidth:u();this.screen.max=this.screen.min+(f?p:c()),this.target={min:0,max:0},this.target.min=f?e(i):n(i),this.target.max=this.target.min+(f?i.offsetWidth:i.offsetHeight),this.hintSize=f?o.offsetWidth:o.offsetHeight}s&&(this.calloutSize.width=s.offsetWidth,this.calloutSize.height=s.offsetHeight),this.horizontal=new f(i,o,r,this.calloutSize,!0),this.vertical=new f(i,o,r,this.calloutSize,!1)}const z=function(){function t(t,e,n){const i=new O(t,e,n),o=r(i.position);n.allowFlip&&(o.horizontal?i.position=L.flipPositionIfRequired(i.horizontal,i.position):o.vertical&&(i.position=L.flipPositionIfRequired(i.vertical,i.position)));const a=function(t){return s(t.position,{width:t.horizontal.target.max-t.horizontal.target.min,height:t.vertical.target.max-t.vertical.target.min},{width:t.horizontal.hintSize,height:t.vertical.hintSize},t.calloutSize)}(i),l={x:0,y:0};return n.allowShift&&(l.x=M.getShift(i.horizontal,o,a.x,0,!0),l.y=M.getShift(i.vertical,o,a.y,0,!1)),{location:{x:a.x+l.x,y:a.y+l.y},shift:l,flipPosition:i.position}}function r(t){return{vertical:"bottom"===t||"top"===t,horizontal:"right"===t||"left"===t}}function s(t,e,n,i){const o={x:0,y:0};return"top"===t?o.y-=n.height+i.height:"bottom"===t?o.y+=e.height+i.height:"left"===t?o.x-=n.width+i.width:"right"===t&&(o.x+=e.width+i.width),"top"!==t&&"bottom"!==t||(o.x+=e.width/2-n.width/2),"left"!==t&&"right"!==t||(o.y+=e.height/2-n.height/2),o}return{set:function(s,a,l){const c=t(s,a,l),u={x:0,y:0},f=r(c.flipPosition);f.horizontal&&(u.x=l.offset*c.location.x/Math.abs(c.location.x)),f.vertical&&(u.y=l.offset*c.location.y/Math.abs(c.location.y));const p=void 0!==l.x?l.x:e(s)+c.location.x+u.x,h=void 0!==l.y?l.y:n(s)+c.location.y+u.y;return i(a,p),o(a,h),{flipPosition:c.flipPosition,shift:{x:c.shift.x,y:c.shift.y}}},getNotShiftedOffsetCore:s}}(),L={flipPositionIfRequired:function(t,e){return this.ensureFlipCore(t.screen,t.target,t.hintSize,e)},getFlipPosition:function(t){return"bottom"===t?"top":"top"===t?"bottom":"right"===t?"left":"left"===t?"right":t},ensureFlipCore:function(t,e,n,i){const o="bottom"===i||"right"===i,r="top"===i||"left"===i;let s=e.min-n-t.min;e.min-n>t.max&&(s=-1);let a=t.max-(e.max+n);e.max+n<t.min&&(a=-1);const l=s>=0,c=a>=0;if(!l&&!c)return i;if(r&&l)return i;if(o&&c)return i;return r&&!l&&s<a||o&&!c&&a<s?this.getFlipPosition(i):i}},M={getShift:function(t,e,n,i,o){let r=0;return!(e.horizontal&&o||e.vertical&&!o)&&(r=this.getShiftCore(t.screen,t.target,t.hintSize,n,i)),r},getShiftCore:function(t,e,n,i,o){if(e.max<t.min+o||e.min>t.max-o)return 0;const r=e.min+i,s=e.min+i+n,a=r<t.min&&s>t.min,l=s>t.max&&r<t.max;if(a&&!l){return t.min-r}if(l&&!a){return t.max-n-r}return 0}},N="none",k="drag",F="resizeTop",P="resizeBottom",q="resizeSelection";function V(t,e,n,i,o,r){if(t&&(t.appointmentToolTipElement&&T(t.appointmentToolTipElement),t.dropDownDateNavigatorElement&&T(t.dropDownDateNavigatorElement),t.dropDownResourceNavigatorElement&&T(t.dropDownResourceNavigatorElement),t.elementContentSizeSubscription&&f(t.elementContentSizeSubscription),st.unsubscribe(t)),!(t=p(t)))return;if(t.dropDownDateNavigatorElement=p(e),t.dropDownResourceNavigatorElement=p(n),t.appointmentToolTipElement=p(i),t.appointmentEditForm=p(o),t.mouseMoveHandlerState||(t.mouseMoveHandlerState=N),t.appointmentToolTipElement){const e=W.getSelectedAppointment(t);e&&setTimeout((function(){const n=function(t,e,n){const i=t.getBoundingClientRect(),o=n.getBoundingClientRect();D.position=m(e,"dxsc-tooltip")?i.right-o.right>370?"right":o.left-i.left>370?"left":o.top-i.top>370?"top":"bottom":i.right-o.right>450?"right":o.left-i.left>450?"left":"auto";return D}(t,t.appointmentToolTipElement,e);E(e,t.appointmentToolTipElement,n)}),0)}t.hDateTimeViewLayout=new X(t,"dxbs-sc-all-day-area"),t.vDateTimeViewLayout=new X(t,"dxbs-sc-time-cell");let s=W.getHorizontalAppointments(t),a=W.getVerticalAppointments(t);if(t.appointmentInfos=G.createItems(s,t.hDateTimeViewLayout,t.vDateTimeViewLayout),t.appointmentInfos=t.appointmentInfos.concat(G.createItems(a,t.hDateTimeViewLayout,t.vDateTimeViewLayout)),t.skipCalculateAllAppointments){const t=function(t){const e=[];for(let n,i=0;n=t[i];i++)m(n,"dxbs-apt-edited")&&e.push(n);return e};return s=t(s),a=t(a),c(s,a,!1),Promise.resolve("ok")}function l(){c(s,a,!0),u()}function c(e,n,i){t.hDateTimeViewLayout.clearObjects(),$(t.hDateTimeViewLayout.getTimeCells(),e),$(t.vDateTimeViewLayout.getTimeCells(),n),function(t){for(let e,n=0;e=t[n];n++)_(e)}(e),i&&function(t){let e=0;for(let n,i=0;n=t[i];i++){let t=0;n.intersects.forEach((function(e){t+=e.offsetHeight})),t>e&&(e=t),n.lastAppointmentTop=void 0}t[0].style.height=e+15+"px"}(t.hDateTimeViewLayout.getTimeCells()),function(t){for(let e,n=0;e=t[n];n++)tt(e)}(n)}function u(){!function(t,e){const n=function(t){const e=(new Date).getTime();return new Date(e)}(),i=(r=n,new Date(r.getFullYear(),r.getMonth(),r.getDate())),o=function(t){const e=[],n=W.getTimeMarkerWrappers(t);for(let t,i=0;t=n[i];i++){const n={wrapper:t,timeMarker:W.getTimeMarkerContainer(t),timeIndicator:W.getTimeIndicatorContainer(t),firstContainerIndex:W.Attr.getFirstContainerIndex(t),lastContainerIndex:W.Attr.getLastContainerIndex(t),startFromContainer:i>0};e.push(n)}return e}(t);var r;if(0===o.length)return;for(let r,s=0;r=o[s];s++)nt(r,t,e,i,n)}(t,t.vDateTimeViewLayout.getTimeCells())}function h(t){t&&r.invokeMethodAsync("OnAppointmentSelect",W.Attr.getAppointmentKey(t))}function H(e){return t.appointmentInfos.filter((function(t){return t.id===e}))[0]}function O(e){if(S("TouchStart")||2===e.button)return 2===e.button&&y(e),void 0;const n=W.getAppointmentContainer(e.srcElement);n?(j(n)||h(n),m(e.srcElement,"dxsc-top-handle")||function(t){return m(t,"dxsc-left-handle")}(e.srcElement)?t.mouseMoveHandlerState=F:function(t){return m(t,"dxsc-bottom-handle")}(e.srcElement)||function(t){return m(t,"dxsc-right-handle")}(e.srcElement)?t.mouseMoveHandlerState=P:x((function(){t.mouseMoveHandlerState=k}),"drag",50,!0)):t.appointmentToolTipElement||B(e.srcElement)&&(t.cellSelectionHelper=new Q(t,r),t.cellSelectionHelper.start(e.srcElement),t.mouseMoveHandlerState=q)}function z(e){t.mouseMoveHandlerState!==N&&(t.throttledDrag||(t.throttledDrag=b.throttle((function(e){const n=t.vDateTimeViewLayout.findCellByPos(e.clientX,e.clientY)||t.hDateTimeViewLayout.findCellByPos(e.clientX,e.clientY);if(n)if(t.mouseMoveHandlerState===q&&t.cellSelectionHelper)t.cellSelectionHelper.resizeTo(n);else{const e=function(){const e=W.getSelectedAppointment(t);return e?H(W.Attr.getAppointmentKey(e)):null}();e&&(t.mouseMoveHandlerState!==k&&t.mouseMoveHandlerState!==F&&t.mouseMoveHandlerState!==P||(t.dragHelper||(t.dragHelper=new Z(t,r),t.dragHelper.dragStart(e,n)),t.mouseMoveHandlerState===k?t.dragHelper.drag(n):t.dragHelper.resize(n,t.mouseMoveHandlerState===F)))}}),20)),t.throttledDrag(e))}function L(e){if(S("TouchEnd")||2===e.button)return 2===e.button&&y(e),void 0;t.dragHelper||t.cellSelectionHelper?t.dragHelper?(t.dragHelper.dragEnd(),t.dragHelper=null):t.cellSelectionHelper&&(t.cellSelectionHelper.end(),t.cellSelectionHelper=null):W.getAppointmentContainer(e.srcElement)&&!S("skipToolTip")&&(r.invokeMethodAsync("ShowAppointmentToolTip"),x((function(){}),"skipToolTip",300)),I("drag"),t.mouseMoveHandlerState=N}function M(t){x((function(){}),"TouchStart",300,!0);h(W.getAppointmentContainer(t.srcElement))}function V(e){const n=W.getAppointmentContainer(e.srcElement);if(n){const i=e.touches[0].clientX,o=e.touches[0].clientY,s=t.vDateTimeViewLayout.findCellByPos(i,o)||t.hDateTimeViewLayout.findCellByPos(i,o),a=H(W.Attr.getAppointmentKey(n));t.dragHelper=new Z(t,r),t.dragHelper.dragStart(a,s)}else B(e.srcElement)&&!t.appointmentToolTipElement&&(t.cellSelectionHelper=new Q(t,r),t.cellSelectionHelper.start(e.srcElement))}function R(e){if(!t.dragHelper&&!t.cellSelectionHelper)return;const n=e.touches[0].clientX,i=e.touches[0].clientY,o=t.vDateTimeViewLayout.findCellByPos(n,i)||t.hDateTimeViewLayout.findCellByPos(n,i);o&&(t.dragHelper?t.dragHelper.drag(o):t.cellSelectionHelper&&t.cellSelectionHelper.resizeTo(o)),y(e)}function K(t){L(t),x((function(){}),"TouchEnd",300,!0)}return!function(t,e,n,i,o){C.attachEventToElement(t,"mousedown",O),C.attachEventToElement(t,"mouseup",L),C.attachEventToElement(t,"mousemove",z),C.attachLongTabEventToElement(t,V),C.attachEventToElement(t,"touchstart",M),C.attachEventToElement(t,"touchmove",R),C.attachEventToElement(t,"touchend",K),e&&(e.dateNavigatorLostFocusHandler=function(t){return et(t,e,"OnDropDownDateNavigatorLostFocus",o)},g(document,w.touchMouseDownEventName,e.dateNavigatorLostFocusHandler),A(e,(function(){v(document,w.touchMouseDownEventName,e.dateNavigatorLostFocusHandler)})));n&&(n.resourceNavigatorLostFocusHandler=function(t){return et(t,n,"OnDropDownResourceNavigatorLostFocus",o)},g(document,w.touchMouseDownEventName,n.resourceNavigatorLostFocusHandler),A(n,(function(){v(document,w.touchMouseDownEventName,n.resourceNavigatorLostFocusHandler)})));i&&(i.toolTipLostFocusHandler=function(t){const e=W.getAppointmentContainer(t.srcElement);if(!e||!j(e))return et(t,i,"OnAppointmentToolTipLostFocus",o)},g(document,w.touchMouseDownEventName,i.toolTipLostFocusHandler),A(i,(function(){v(document,w.touchMouseDownEventName,i.toolTipLostFocusHandler)})));t.elementContentSizeSubscription=d(t,l),st.subscribe(t,u)}(t,t.dropDownDateNavigatorElement,t.dropDownResourceNavigatorElement,t.appointmentToolTipElement,r),Promise.resolve("ok")}const W={getVerticalAppointmentsContainer:function(t){return t.querySelectorAll(".dxbs-sc-vertical-apts")[0]},getHorizontalAppointmentsContainer:function(t){return t.querySelectorAll(".dxbs-sc-horizontal-apts")[0]},getHorizontalAppointments:function(t){return t.querySelectorAll(".dxbs-sc-horizontal-apt")},getVerticalAppointments:function(t){return t.querySelectorAll(".dxbs-sc-vertical-apt")},getTimeMarkerWrappers:function(t){return t.querySelectorAll(".dxbs-sc-time-marker-wrapper")},getTimeMarkerContainer:function(t){return t.querySelectorAll(".dxbs-sc-time-marker")[0]},getTimeIndicatorContainer:function(t){return t.querySelectorAll(".dxbs-sc-time-indicator")[0]},getAppointmentContainer:function(t){return h(t,"dxbs-sc-apt")},getSelectedAppointment:function(t){return t.querySelectorAll(".dxbs-apt-selected")[0]},getEditedAppointment:function(t){return t.querySelectorAll(".dxbs-apt-edited")[0]},getCellSelectionContainer:function(t){return t.querySelectorAll(".dxsc-cell-selection")[0]},setElementDisplay:function(t,e){t.style.display=e?"":"none"},Attr:{getContainerIndex:function(t){return parseInt(t.getAttribute("data-container-index"))},getFirstContainerIndex:function(t){return parseInt(t.getAttribute("data-first-container-index"))},getLastContainerIndex:function(t){return parseInt(t.getAttribute("data-last-container-index"))},getAppointmentFirstCellIndex:function(t){return parseInt(t.getAttribute("data-first-cell-index"))},getAppointmentLastCellIndex:function(t){return parseInt(t.getAttribute("data-last-cell-index"))},getAppointmentColumnsCount:function(t){return parseInt(t.getAttribute("data-columns-count"))},setAppointmentColumnsCount:function(t,e){t.setAttribute("data-columns-count",e)},getAppointmentColumn:function(t){return parseInt(t.getAttribute("data-column"))},setAppointmentColumn:function(t,e){t.setAttribute("data-column",e)},getAppointmentKey:function(t){return t.getAttribute("data-key")},getStart:function(t){const e=new Date(parseInt(t.getAttribute("data-start"))),n=e.getTime()+6e4*e.getTimezoneOffset()+0;return new Date(n)},getEnd:function(t){const e=new Date(parseInt(t.getAttribute("data-end"))),n=e.getTime()+6e4*e.getTimezoneOffset()+0;return new Date(n)},getDuration:function(t){return parseInt(t.getAttribute("data-duration"))},getAllDay:function(t){return""===t.getAttribute("data-allday")},getResourceKey:function(t){return t.getAttribute("data-resource")}}};function B(t){return m(t,"dxbs-sc-all-day-area")||m(t,"dxbs-sc-time-cell")}function R(t){return m(t,"dxbs-sc-all-day-area")}function j(t){return m(t,"dxbs-apt-selected")}function K(t){const e=W.Attr.getStart(t);return U(e,W.Attr.getEnd(t)-e)}function Y(t){return W.Attr.getResourceKey(t)}function U(t,e){return{start:t,duration:e,isLongerOrEqualDay:e>=J.DaySpan}}const X=function(t,e){this.element=t,this.cellClassName=e};X.prototype={getContainers:function(){if(!this.containers){const t=this.element.querySelectorAll("."+this.cellClassName);this.containers={};for(let e,n=0;e=t[n];n++){const t=W.Attr.getContainerIndex(e);this.containers[t]||(this.containers[t]={cells:[]}),this.containers[t].cells.push(e)}}return this.containers},clearObjects:function(){const t=this.getTimeCells();for(let e,n=0;e=t[n];n++)this.clearObject(e)},clearObject:function(t){t.lastAppointmentTop=void 0},getTimeCells:function(){return this.timeCells||(this.timeCells=this.element.querySelectorAll("."+this.cellClassName)),this.timeCells},findCell:function(t){const e=this.getContainers();for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n))for(let i,o=0;i=e[n].cells[o];o++){const e=W.Attr.getStart(i),n=W.Attr.getEnd(i);if(e-t<=0&&t-n<0)return i}return null},findStartCell:function(t){const e=this.getContainers();for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n))for(let i,o=0;i=e[n].cells[o];o++){if(t-W.Attr.getStart(i)<=0)return i}return null},findEndCell:function(t){const e=this.getContainers();for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n))for(let i,o=0;i=e[n].cells[o];o++){if(t-W.Attr.getEnd(i)<=0)return i}return null},findCellByPos:function(t,e){const n=this.getTimeCells();for(let i,o=0;i=n[o];o++){const n=i.getBoundingClientRect();if(n.top<=e&&e<n.bottom&&n.left<=t&&t<n.right)return i}}};const G=function(t,e,n,i){this.id=t,this.views=e,this.interval=n,this.allDay=W.Attr.getAllDay(e[0]),this.resourceKey=Y(e[0]),this.sourceView=null,this.aptCont=null,this.dateTimeViewLayout=i,this.init()};G.prototype={init:function(){this.sourceView=this.views[0].cloneNode(!0),this.aptCont=this.views[0].parentElement},getStart:function(){return this.interval.start},getDuration:function(){return this.interval.duration},getEnd:function(){return J.dateIncreaseWithUtcOffset(this.getStart(),this.getDuration())},clearViews:function(){this.views.forEach((function(t){t.parentElement.removeChild(t)})),this.views=[]}},G.createItem=function(t,e,n,i){const o=function(t){return U(W.Attr.getStart(t[0]),W.Attr.getDuration(t[0]))}(e);return new G(t,e,o,o.duration>=J.DaySpan?n:i)},G.createItems=function(t,e,n){const i={};for(let e,n=0;e=t[n];n++){const t=W.Attr.getAppointmentKey(e);i[t]||(i[t]=[]),i[t].push(e)}const o=[];for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&o.push(G.createItem(t,i[t],e,n));return o};const J={HalfHourSpan:18e5,DaySpan:864e5,dateSubsWithTimezone:function(t,e){return t-e+6e4*(e.getTimezoneOffset()-t.getTimezoneOffset())},truncToDate:function(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate())},calculateDaysDifference:function(t,e){const n=J.truncToDate(t),i=J.truncToDate(e);return J.dateSubsWithTimezone(i,n)/J.DaySpan},dateIncreaseWithUtcOffset:function(t,e){const n=J.dateIncrease(t,e),i=6e4*(n.getTimezoneOffset()-t.getTimezoneOffset());return J.dateIncrease(n,i)},dateIncrease:function(t,e){return new Date(t.valueOf()+e)},addTimeSpan:function(t,e){return new Date(t.valueOf()+e)},toDayTime:function(t){return t.valueOf()-J.truncToDate(t).valueOf()}};function Q(t,e){this.scheduler=t,this.dotnetHelper=e,this.interval=null,this.start=function(t){this.interval=K(t);const e=this.interval.start,n=J.dateIncreaseWithUtcOffset(e,this.interval.duration),i=Y(t),o=6e4*e.getTimezoneOffset()*-1;this.dotnetHelper.invokeMethodAsync("OnCellSelectionStart",J.addTimeSpan(e,o),J.addTimeSpan(n,o),R(t),i)},this.resizeTo=function(t){const e=K(t),n=e.start-this.interval.start;if(0===n&&this.interval.duration===e.duration)return;n<0&&this.interval.duration===e.duration?this.direction="top":n>0&&this.interval.duration===e.duration&&(this.direction="bottom"),"bottom"===this.direction?this.interval.duration=n+e.duration:"top"===this.direction&&(this.interval.start=e.start,this.interval.duration+=-1*n);const i=this.interval.start,o=J.dateIncreaseWithUtcOffset(i,this.interval.duration),r=Y(t),s=6e4*i.getTimezoneOffset()*-1;this.dotnetHelper.invokeMethodAsync("OnCellSelectionResize",J.addTimeSpan(i,s),J.addTimeSpan(o,s),R(t),r)},this.end=function(){this.dotnetHelper.invokeMethodAsync("OnCellSelectionEnd",this.scheduler.offsetWidth<500)}}function Z(t,e){this.scheduler=t,this.dotnetHelper=e,this.appointmentInfo=null,this.interval=null,this.dragStart=function(t,e){this.appointmentInfo=t,this.sourceAppointmentInterval=U(t.getStart(),t.getDuration()),this.cellInterval=K(e),this.dateDiff=t.getStart()-this.cellInterval.start,this.dotnetHelper.invokeMethodAsync("OnAppointmentDragStart"),this.scheduler.skipCalculateAllAppointments=!0},this.drag=function(t){if(!this.cellInterval)return;const e=K(t);if(this.cellInterval.start-e.start==0&&this.cellInterval.duration===e.duration)return;e.isLongerOrEqualDay?this.sourceAppointmentInterval.isLongerOrEqualDay&&this.cellInterval.isLongerOrEqualDay===e.isLongerOrEqualDay?this.appointmentInfo.interval=U(J.addTimeSpan(e.start,this.dateDiff),this.appointmentInfo.interval.duration):(this.appointmentInfo.interval=e,this.appointmentInfo.allDay=!0):(this.appointmentInfo.interval.isLongerOrEqualDay&&(this.appointmentInfo.interval.duration=this.sourceAppointmentInterval.isLongerOrEqualDay?e.duration:this.sourceAppointmentInterval.duration),this.appointmentInfo.interval=U(J.addTimeSpan(e.start,this.dateDiff),this.appointmentInfo.interval.duration),this.appointmentInfo.allDay=!1),this.updateResource(t);const n=6e4*e.start.getTimezoneOffset()*-1;this.dotnetHelper.invokeMethodAsync("OnAppointmentDrag",J.addTimeSpan(this.appointmentInfo.getStart(),n),J.addTimeSpan(this.appointmentInfo.getEnd(),n),this.appointmentInfo.allDay,this.appointmentInfo.resourceKey),this.cellInterval=e},this.resize=function(t,e,n){if(!this.cellInterval)return;const i=K(t);if(this.cellInterval.start-i.start==0&&this.cellInterval.duration===i.duration||this.cellInterval.isLongerOrEqualDay!==i.isLongerOrEqualDay)return;const o=this.cellInterval.start-i.start;e?this.appointmentInfo.interval=U(J.addTimeSpan(i.start,this.dateDiff),this.appointmentInfo.interval.duration+o):this.appointmentInfo.interval.duration-=o,this.updateResource(t);const r=6e4*i.start.getTimezoneOffset()*-1;this.dotnetHelper.invokeMethodAsync("OnAppointmentDrag",J.addTimeSpan(this.appointmentInfo.getStart(),r),J.addTimeSpan(this.appointmentInfo.getEnd(),r),this.appointmentInfo.allDay,this.appointmentInfo.resourceKey),this.cellInterval=i},this.dragEnd=function(){this.dotnetHelper.invokeMethodAsync("OnAppointmentDragEnd"),this.scheduler.skipCalculateAllAppointments=!1},this.updateResource=function(t){this.appointmentInfo.resourceKey&&(this.appointmentInfo.resourceKey=Y(t))}}function $(t,e){const n={};for(let e,i=0;e=t[i];i++){e.intersects=[];const t=W.Attr.getContainerIndex(e);n[t]||(n[t]=[]),n[t].push(e)}for(let t,i=0;t=e[i];i++){const e=W.Attr.getContainerIndex(t),i=W.Attr.getAppointmentFirstCellIndex(t),o=W.Attr.getAppointmentLastCellIndex(t);n[e]&&(t.firstCell=n[e][i],t.lastCell=n[e][o])}}function _(t){t.style.height="",function(t,e){t.intersects.findIndex((function(t){return W.Attr.getAppointmentKey(t)===W.Attr.getAppointmentKey(e)}))<0&&t.intersects.push(e)}(t.firstCell,t),t.style.left=t.firstCell.offsetLeft+"px",t.style.width=t.lastCell===t.firstCell?t.firstCell.offsetWidth+"px":t.lastCell.offsetLeft-t.firstCell.offsetLeft+t.firstCell.offsetWidth+"px",t.firstCell.lastAppointmentTop||(t.firstCell.lastAppointmentTop=t.firstCell.offsetTop),t.style.display="",t.style.top=t.firstCell.lastAppointmentTop+"px",t.firstCell.lastAppointmentTop+=t.offsetHeight}function tt(t){const e=W.Attr.getAppointmentColumn(t),n=t.firstCell.offsetWidth/W.Attr.getAppointmentColumnsCount(t);t.style.top=t.firstCell.offsetTop+"px",t.style.left=t.firstCell.offsetLeft+n*e+"px",t.style.width=n-10+"px",t.style.height=t.lastCell.offsetTop+t.lastCell.offsetHeight-t.firstCell.offsetTop+"px",t.style.display=""}function et(t,e,n,i){return function(t,e,n){let i=t.target;for(;i;){if(i===e)return!1;i=i.parentElement}n&&n()}(t,e,(function(){e&&"string"!=typeof e&&"none"!==e.style.display&&i.invokeMethodAsync(n)}))}function nt(t,e,n,i,o){const r=t.wrapper,s=function(t,e,n,i){const o=[];for(let r,s=0;r=t[s];s++)W.Attr.getContainerIndex(r)<n||W.Attr.getContainerIndex(r)>i||e-W.Attr.getStart(r)>=0&&W.Attr.getEnd(r)-e>0&&o.push(r);return o}(n,o,t.firstContainerIndex,t.lastContainerIndex);if(!s.length)return r.style.display="none",void 0;r.style.display="";const a=t.timeMarker,l=t.timeIndicator,c=a.offsetHeight/2,u=s[0].offsetLeft;let f=0;if(t.startFromContainer){const e=function(t,e){for(let n,i=0;n=t[i];i++)if(W.Attr.getContainerIndex(n)===e)return n;return null}(n,t.firstContainerIndex);f=e.offsetLeft===u?u-c:e.offsetLeft}const p=Math.floor(function(t,e,n){const i=function(t,e){const n=t,i=ot(e,n);let o=Math.abs(i)%864e5;i<0&&(o=864e5-o);return function(t,e){const n=it(t,e),i=6e4*(n.getTimezoneOffset()-t.getTimezoneOffset());return it(n,i)}(n,o)}(n,t),o=W.Attr.getStart(e),r=W.Attr.getEnd(e),s=ot(i,o);return e.offsetTop+e.offsetHeight*s/(r-o)}(o,s[0],i));if(a.style.top=p-c+"px",a.style.left=f+"px",a.style.width=u-f+c+1+"px",(h=r)&&"none"!==h.style.display){let t=0;for(let e,n=0;e=s[n];n++)t+=e.offsetWidth;l.style.top=p-1+"px",l.style.width=t+"px",l.style.left=u+"px"}var h}function it(t,e){return new Date(t.valueOf()+e)}function ot(t,e){return t-e+6e4*(e.getTimezoneOffset()-t.getTimezoneOffset())}function rt(t){for(;null!=t;){if("BODY"===t.tagName)return!0;t=t.parentNode}return!1}const st=new function(){this.subscriptions=[],this.timerId=-1,this.subscribe=function(t,e){if(-1===this.getSubscriptionIndex(t)){this.subscriptions.push({scheduler:t,updateAction:e}),-1===this.timerId&&this.startTimer()}},this.unsubscribe=function(t){const e=this.getSubscriptionIndex(t);-1!==e&&this.unsubscribeByIndex(e)},this.unsubscribeByIndex=function(t){this.subscriptions.splice(t)},this.getSubscriptionIndex=function(t){for(let e,n=0;e=this.subscriptions[n];n++)if(e.scheduler===t)return n;return-1},this.startTimer=function(){this.timerId=setTimeout(this.onTimeout.bind(this),6e4)},this.onTimeout=function(){for(let t,e=0;t=this.subscriptions[e];e++)if(rt(t.scheduler))try{t.updateAction()}catch(t){}else this.unsubscribeByIndex(e),e--;this.startTimer()}};function at(t){return(t=p(t))&&(T(t),st.unsubscribe(t)),Promise.resolve("ok")}const lt={init:V,dispose:at};export default lt;export{at as dispose,V as init};
