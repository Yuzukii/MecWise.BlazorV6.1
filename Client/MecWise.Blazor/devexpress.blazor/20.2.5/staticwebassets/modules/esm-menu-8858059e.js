import"./esm-chunk-d81494b9.js";import"./esm-chunk-a2731447.js";import{ensureElement as e,unsubscribeElement as t,subscribeElementContentSize as s,toggleCssClass as i,getCurrentStyle as n,elementHasCssClass as l}from"./esm-dom-utils-0e4190ff.js";import{d as h}from"./esm-chunk-f1e43abb.js";const a=new Map;function o(t,s,i){const n=e(t);if(null===n)return;let l=a.get(n);l||(l=new c,a.set(n,l)),l.init(n,s,i)}class c{constructor(){this.itemsOffset=0,this.itemsWidth=0,this.itemsMinWidth=0,this.items=[]}init(e,n,l){if(this.mainElement=e,this.sizeChanged&&(t(this.sizeChanged),this.sizeChanged=null),n.canCollapse&&(n.collapseToIcons||n.collapseToIconsAll||n.collapseToHamburgerMenu)){this.currentWidth=e.offsetWidth,this.menu||(this.menu=new r),this.menu.update(n),this.updateMenuItems(n.items),n.isCollapsed||(this.menu.isVertical?(this.itemsOffset=0,this.itemsWidth=Math.max.apply(Math,this.items.map(e=>e.width)),this.itemsMinWidth=0,this.collapseToHamburgerWidth=-1):(this.itemsOffset=this.calculateItemsOffset(e),this.itemsWidth=this.calculateItemsWidth(),this.itemsMinWidth=this.calculateItemsMinWidth(),this.collapseToHamburgerWidth=this.menu.collapseToIcons||this.menu.collapseToIconsAll?this.itemsMinWidth+this.itemsOffset:this.itemsWidth+this.itemsOffset)),this.sizeChanged=s(e,e=>this.resizeMenuItemsByWidth(e.width,l)),this.resizeMenuItemsByWidth(e.offsetWidth,l);const t=e.querySelector("ul.invisible");t&&i(t,"invisible",!1)}else this.increaseAllItems()}dispose(){this.sizeChanged&&t(this.sizeChanged)}updateMenuItems(e){const t=[];e&&Array.from(e).forEach(e=>{let s=this.items.find(t=>t.id===e.id);if(!s){const t=this.mainElement.querySelector("[data-dxmenu-item-id="+e.id+"]");s=new m(t)}t.push(s),s.update(e),!s.needUpdateSizes&&s.textElement||this.updeteMenuItemSizes(s)}),this.items=t,this.items.sort((function(e,t){return e.adaptivePriority-t.adaptivePriority}))}updeteMenuItemSizes(e){const t=e.element.querySelector("div.dx-menu-item-text-container");let s=n(e.element),i=parseFloat(s.paddingLeft)+parseFloat(s.paddingRight)+parseFloat(s.marginLeft)+parseFloat(s.marginRight),l=0;const h=e.element.children[0];if(h){s=n(h),i+=parseFloat(s.paddingLeft)+parseFloat(s.paddingRight)+parseFloat(s.marginLeft)+parseFloat(s.marginRight);for(let e=0;e<h.children.length;e++){const s=h.children[e],n=s.offsetWidth;i+=n,s.isSameNode(t)&&(l=n)}}e.updateSizes(t,i,l)}resizeMenuItemsByWidth(e,t){if(this.menu.isCollapsed)(e>this.collapseToHamburgerWidth||!this.menu.collapseToHamburgerMenu)&&t.invokeMethodAsync("OnMenuCollapse",!1);else{const s=e-this.currentWidth;if(this.menu.isVertical)this.menu.collapseToIconsAll&&(s<=0&&this.itemsWidth>e?this.reduceAllItems():this.itemsWidth<e&&this.increaseAllItems());else{if(this.menu.collapseToIcons){let t=this.itemsOffset;this.items.forEach(e=>{t+=e.width,e.canIncrease()&&(t-=e.textWidth)}),s<=0&&t>e?this.reduceItems(e,t):s>=0&&this.increaseItems(e,t)}else if(this.menu.collapseToIconsAll){const t=this.itemsWidth+this.itemsOffset;s<=0&&t>e?this.reduceAllItems():s>=0&&t<e&&this.increaseAllItems()}else this.increaseAllItems();this.menu.collapseToHamburgerMenu&&s<=0&&e<this.collapseToHamburgerWidth&&t.invokeMethodAsync("OnMenuCollapse",!0)}}this.currentWidth=e}reduceItems(e,t){for(let s=this.items.length-1;s>=0&&t>e;s--){const e=this.items[s];e.canReduce()&&(e.hideTextElement(),t-=e.textWidth)}}increaseItems(e,t){for(let s=0;s<this.items.length;s++){const i=this.items[s];if(i.canIncrease()){if(t+i.textWidth>e)break;i.showTextElement(),t+=i.textWidth}}}reduceAllItems(){for(let e=0;e<this.items.length;e++){const t=this.items[e];t.canReduce()&&t.hideTextElement()}}increaseAllItems(){for(let e=0;e<this.items.length;e++){const t=this.items[e];t.canIncrease()&&t.showTextElement()}}calculateItemsOffset(e){const t=e.querySelector(".dxbs-menu ul.nav");return t?t.offsetLeft-e.offsetLeft:0}calculateItemsWidth(){let e=0;return this.items.forEach(t=>e+=t.width),e}calculateItemsMinWidth(){let e=0;return this.items.forEach(t=>{e+=t.width,t.canCollapse()&&(e-=t.textWidth)}),e}}class r{update(e){this.isVertical=e.isVertical,this.isCollapsed=e.isCollapsed,this.canCollapse=e.canCollapse,this.collapseToIcons=e.collapseToIcons,this.collapseToIconsAll=e.collapseToIconsAll,this.collapseToHamburgerMenu=e.collapseToHamburgerMenu}}class m{constructor(e){this.element=e,this.needUpdateSizes=!0}update(e){this.id=e.id,this.canCrop=e.canCrop,this.adaptivePriority=e.adaptivePriority}updateSizes(e,t,s){this.needUpdateSizes=!1,this.width=t,this.textWidth=s,this.textElement=e}canCollapse(){return this.canCrop&&this.textElement}canReduce(){return this.canCollapse()&&!l(this.textElement,"dx-menu-text-hidden")}canIncrease(){return this.canCollapse()&&l(this.textElement,"dx-menu-text-hidden")}showTextElement(){i(this.textElement,"dx-menu-text-hidden",!1)}hideTextElement(){i(this.textElement,"dx-menu-text-hidden",!0)}}function d(e){e.currentTarget.addEventListener("focusin",u)}function u(e){e.currentTarget.removeEventListener("focusin",u),e.currentTarget.blur()}const p={init:o,dispose:function(t){(t=e(t))&&h(t);const s=a.get(t);return s&&(s.dispose(),a.delete(t)),Promise.resolve("ok")},addNavItemClickHandler:function(e){e.addEventListener("mousedown",d)},resetFocusForDropDownItem:function(){document.activeElement&&"A"===document.activeElement.tagName&&document.activeElement.classList.contains("dropdown-item")&&document.activeElement.blur()}};export default p;export{o as init};
