import{D as t}from"./dom-a06f5987.js";import{k as e}from"./key-643beca5.js";import{T as n}from"./touch-2ca1b361.js";import{c as o,e as i,g as s,s as r,a as c,i as l,R as a}from"./dom-utils-d8c2ed7a.js";import{d as u,r as d}from"./disposable-35c3c450.js";import{scrollToFocusedItem as h}from"./grid-adc97dfb.js";import{s as f,g as m,a as p}from"./popup-utils-5ca88cd0.js";import{initFocusHidingEvents as g}from"./focus-utils-1ab9273a.js";import{g as w,a as v,P as y,E as b,b as x}from"./dragAndDropUnit-238107dc.js";import"./evt-20927eae.js";import"./column-resize-9da63f0f.js";import"./dx-style-helper-bbeeef94.js";const C=document.body,E=new WeakMap,S=new Map,P={subtree:!0,childList:!0},L=new MutationObserver((function(t){t.forEach(D)}));function D(t){t.removedNodes.forEach(M)}function M(t){const e=S.get(t);S.delete(t)&&(0===S.size&&L.disconnect(),e())}class R{constructor(t,e){this.element=t,this.getClientRect=e}get leftTopCorner(){const t=this;return new T(this.element,(function(e){return t.getClientRect(e)}),(function(t){return{x:0,y:0}}))}get leftBottomCorner(){const t=this;return new T(this.element,(function(e){const n=t.getClientRect(e);return new y(n.x,n.bottom)}),(function(e){const n=t.getClientRect(e);return new y(0,-n.height)}))}get rightTopCorner(){const t=this;return new T(this.element,(function(e){const n=t.getClientRect(e);return new y(n.right,n.y)}),(function(e){const n=t.getClientRect(e);return new y(-n.width,0)}))}get rightBottomCorner(){const t=this;return new T(this.element,(function(e){const n=t.getClientRect(e);return new y(n.right,n.bottom)}),(function(e){const n=t.getClientRect(e);return new y(-n.width,-n.height)}))}get center(){const t=this;return new T(this.element,(function(e){return t.getClientRect(e).center}))}}class T{constructor(t,e,n){this.element=t,this.getLocation=e,this.getDelta=n}get location(){return this.getLocation(this.element)}get delta(){return this.getDelta(this.element)}anchorTo(t){return new O(this,t)}}class O{constructor(t,e){this.point=t,this.anchor=e,this.events=new b(this);const n=[];if(n.push([window,"resize"]),n.push([window,"scroll"]),this.containers=function(t,e){const n=[];for(;null!==t&&"BODY"!==t.tagName&&"#document"!==t.nodeName;)e(t)&&n.push(t),t=t.parentNode;return 0===n.length?null:n}(this.anchor.element.parentNode,this.isElementScrollable),this.containers&&this.containers.forEach((function(t){n.push([t,"scroll"])})),this.checkInCasesInt(n),"undefined"!=typeof ResizeObserver){const t=this;this.resizeObserver=new window.ResizeObserver((function(){t.update()})),this.resizeObserver.observe(this.anchor.element),this.resizeObserver.observe(this.point.element)}else this.resizeObserver=null;this.notStaticParent=this.point.element.offsetParent,this.notStaticParent=null!==this.notStaticParent?this.notStaticParent:{x:0,y:0,scrollTop:0,scrollLeft:0},this.notStaticParent=this.isStatic(this.notStaticParent)?window:this.notStaticParent,this.update()}isElementScrollable(t){const e=window.getComputedStyle(t);return"static"===e.position&&("scroll"===e["overflow-x"]||"scroll"===e["overflow-y"]||"auto"===e["overflow-x"]||"auto"===e["overflow-y"])}isStatic(t){if(!t.style)return!1;return"static"===window.getComputedStyle(t).position}update(){const t=this.notStaticParent===window?{x:window.scrollX,y:window.scrollY}:{x:this.notStaticParent.scrollLeft,y:this.notStaticParent.scrollTop},e=x(this.anchor.location,"+",this.point.delta,"-",this.notStaticParent,"+",t),n=this.point.element;o((function(){n.style.left=e.x+"px",n.style.top=e.y+"px"}))}checkInCasesInt(t){const e=this.events;t.forEach((function(t){e.attachEvent(t[0],t[1],(function(t){this.update()}))}))}checkInCases(){return this.containers?(this.checkInCasesInt(Array.from(arguments)),this.update(),this):this}dispose(){this.events&&(this.events.dispose(),this.events=null,this.dropDownStartPos=null,this.containers=null,this.resizeObserver&&this.resizeObserver.disconnect())}}function N(t){return new R(t,w)}function B(t){return new R(t,v)}var z;!function(t){t[t.Popup=0]="Popup",t[t.Modal=1]="Modal"}(z||(z={}));const k=window.console;var j;!function(t){t[t.Down=1]="Down",t[t.Up=2]="Up"}(j||(j={}));const H=new WeakMap;let I;function W(t){let e=(t=i(t)).querySelector("div.dxbs-dm.dropdown-menu");return e||(e=t.querySelector("div.dxgvCSD.dxbs-grid-vsd")),e}function q(t,e,n,o){return new Promise(((n,s)=>{let r=W(t);r=i(r),r?(0===o&&(r.style.minWidth=t.offsetWidth+"px"),2===o&&(r.style.width=t.offsetWidth+"px"),F(t,r,e),h(r),n()):n()}))}function F(t,e,n){H.has(t)&&(H.get(t).disconnect(),H.delete(t));const i=e.offsetParent;if(!i)return void o((function(){e.style.visibility=""}));const s=i.getBoundingClientRect(),r=t.getBoundingClientRect(),c=r.top-s.top,l=s.bottom-r.bottom;let a;const u=window.getComputedStyle(e),d=e.offsetHeight+Math.max(parseFloat(u.marginTop),0)+Math.max(parseFloat(u.marginBottom),0)+8;switch(n){case j.Up:a=!0,s.top+(c-d)<=0&&s.top+c+t.offsetHeight+d+window.pageYOffset<=Math.max(document.body.scrollHeight,window.innerHeight)&&(a=!1);break;case j.Down:default:a=!1,s.bottom-(l-d)>=window.innerHeight&&s.top+c-d+window.pageYOffset>=0&&(a=!0);break}const h=r.left+e.offsetWidth+8>=document.body.clientWidth&&r.right-e.offsetWidth-8>0;o((()=>{I&&I.dispose(),I=a?h?N(e).rightBottomCorner.anchorTo(B(t).rightTopCorner):N(e).leftBottomCorner.anchorTo(B(t).leftTopCorner):h?N(e).rightTopCorner.anchorTo(B(t).rightBottomCorner):N(e).leftTopCorner.anchorTo(B(t).leftBottomCorner),e.style.visibility=""}))}const A=[{value:0,text:""},{value:1,text:"above"},{value:2,text:"below"},{value:4,text:"top-sides"},{value:8,text:"bottom-sides"},{value:16,text:"outside-left"},{value:32,text:"outside-right"},{value:64,text:"left-sides"},{value:128,text:"right-sides"}];function U(t,e,n){let o=t.target;for(;o;){if(o===e)return;o=o.parentElement}n&&n()}function Y(t){return"hidden"!==t.style.visibility||t.classList.contains("dxbs-visually-hidden")}const V="a[href], input:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex='-1'])";function _(t,e){if(!e)return!1;if(s(t.srcElement,"modal-header"))return!0;const n=s(t.srcElement,"column-chooser-elements-container"),o=s(n,"modal-body");if(!n||!o)return!1;if(o.clientHeight>=n.clientHeight)return!0;const i=t.touches[0].pageY-e.touches[0].pageY,r=t=>t.getBoundingClientRect().top,c=n.querySelector(".column-chooser-element-container");if(c&&r(c)===r(o)&&i>=0&&t.cancelable)return!0;const l=t=>Math.round(t.getBoundingClientRect().bottom),a=n.querySelector(".column-chooser-element-container:last-child");return a&&l(a)===l(o)&&i<=0&&t.cancelable}function G(t,e,n){if(n!==z.Modal)return-1;const o=t.getBoundingClientRect(),i=e.getBoundingClientRect(),r=s(t,"dxbs-gridview"),c=r&&r.querySelector("thead");if(!c)return-1;const l=c.getBoundingClientRect(),a=(l||o).bottom;return a>.5*e.clientHeight?a-o.top<.5*e.clientHeight?a-i.top-.5*e.clientHeight:o.top-i.top-2:-1}function K(t){if(!(t=i(t)))return;const e=t.getElementsByClassName("modal-body")[0];e.style.width=e.offsetWidth+"px",e.style.height=e.offsetHeight+"px"}const X={init:function(t,e,o,s){if(t=i(t),e=i(e),o=i(o),!t)return Promise.reject("failed");if(u(t),o){const i=n=>{U(n,t,(function(){c(t)||u(t);const n=document.activeElement===e,i=o&&Y(o);(n||i)&&s.invokeMethodAsync("OnDropDownLostFocus",e.value).catch((t=>k.error(t)))}))};document.addEventListener(n.touchMouseDownEventName,i),d(t,(function(){document.removeEventListener(n.touchMouseDownEventName,i)}))}return Promise.resolve("ok")},dispose:function(t){return(t=i(t))&&u(t),I&&I.dispose(),Promise.resolve("ok")},showAdaptiveDropdown:function(c,u,d,h,w,v){if(!(c=i(c)))return Promise.reject();const y=s(c,d);if(!y)return Promise.reject();const b=document.documentElement,x=document.documentElement.style.overflow,D=document.body.style.overflow,M=document.body.scroll,R=u.dialogType,T=u.alignment,O=R===z.Modal;if(R===z.Popup)0===T?F(y,c,u.dropDownDirection):f(c,y,function(t){let e="";return A.forEach((n=>{0!=(n.value&t)&&(e&&(e+=" "),e+=n.text)})),e}(T));else{c.style.paddingRight=m(c)+p()+"px";const t=m(document.body)+p();document.body.style.paddingRight=String(t),document.body.classList.add("modal-open")}let N=!1;function B(t){const e=t.srcElement;c&&e&&(!c.contains(e)||R===z.Modal&&c===e)&&H(c)}function j(t){const e=t.target;e&&(b.removeEventListener("focusin",j),null===t.relatedTarget&&c&&c.contains(e)&&e.focus())}function H(t){if(!N){if(N=!0,l(t))return;I(),w.invokeMethodAsync("CloseDialog").catch((function(e){l(t)||k.error(e)}))}}function I(){b.removeEventListener(n.touchMouseDownEventName,B),window.removeEventListener("resize",q),U(R,!1),c=null}function W(){if(!c)return;const t=c.querySelector(V);t&&t.focus()}function q(){if(!c||!s(c,"modal-dialog-owner"))return;const t=c.firstElementChild;if(!t)return;const e=t.classList,n=G(y,b,R),o=b.clientHeight>b.clientWidth?"topVertical":"topHorizontal";a((function(){e.contains("topVertical")||e.contains("topHorizontal")?e.remove("transition"):e.add("transition"),n&&(b.scrollTop=n),e.remove("topVertical","topHorizontal"),e.add(o)}))}function U(t,e){if(t!==z.Modal)return;let n,o,i;e?(n="hidden",o="hidden",i=()=>{}):(n=x,o=D,i=M),document.documentElement.style.overflow=n,document.body.style.overflow=o,document.body.scroll=i}return b.addEventListener(n.touchMouseDownEventName,B),c.addEventListener("keydown",(function(t){c&&t.keyCode===e.KeyCode.Esc&&H(c)})),c.addEventListener("focusout",(function(t){const e=t.relatedTarget;!N&&c&&(e&&!c.contains(e)?function(t){if(!c)return;const e=c.compareDocumentPosition(t);e&window.Node.DOCUMENT_POSITION_PRECEDING?function(){if(!c)return;const t=function(t){const e=t.querySelectorAll(V);return e[e.length-1]}(c);t&&t.focus()}():e&window.Node.DOCUMENT_POSITION_FOLLOWING&&W()}(e):null===e&&b.addEventListener("focusin",j))})),function(t,e,n,o){t&&e.addEventListener("touchmove",(t=>{t.srcElement===e&&t.preventDefault()}));if(o===z.Modal){let t;n.addEventListener("touchstart",(e=>{t=e})),n.addEventListener("touchmove",(e=>{_(e,t)&&e.preventDefault(),t=e}))}}(O,c,y,R),function(t){if(E.has(t))return E.get(t);const e=new Promise((function(e){0===S.size&&L.observe(C,P),S.set(t,(()=>{e(void 0)}))}));return E.set(t,e),e}(c).then((()=>{R===z.Modal&&(document.body.classList.remove("modal-open"),document.body.style.paddingRight=String(m(document.body)-p())),I(),c=null})),U(R,!0),o((function(){c&&(u.showFocus||(t.addClassName(c,"dxbs-focus-hidden"),g(c)),R===z.Popup&&(W(),function(t,e){const n=s(t,e);if(t&&n){const e=s(t,"dx-menu-bar");e&&e.classList.contains("vertical")||(r(n,o),o())}function o(){const e=t.getBoundingClientRect(),o=n.getBoundingClientRect(),i=parseFloat(t.style.marginLeft);if(i&&(e.x=e.x-i),e.x+e.width>o.x+o.width&&o.width>e.width){const n=s(t.parentNode,"dropdown-menu");if(n){const o=n.getBoundingClientRect(),i=parseFloat(window.getComputedStyle(n,null).getPropertyValue("border-right-width"));t.style.marginLeft="-"+(e.x+e.width-o.x-i)+"px"}else t.style.marginLeft="-"+(e.x+e.width-o.x-o.width)+"px"}else i&&(t.style.marginLeft="")}}(c,v)))})),R===z.Modal&&(window.addEventListener("resize",q),q()),Promise.resolve()},updateGridDropDown:q,setInlineModalSize:K};export default X;export{z as DialogType,W as getDropDownElement,Y as isDropDownVisible,U as onOutsideClick,G as scrollDropDown,K as setInlineModalSize,F as setPositionOfDropDown,_ as shouldPreventTouchMove,q as updateGridDropDown};
