import{e as t,z as n}from"./dom-utils-d8c2ed7a.js";import{F as e,D as o,a as s,R as c,E as i}from"./dragAndDropUnit-238107dc.js";import"./dom-a06f5987.js";import"./touch-2ca1b361.js";let a,u,l,r,d,f,p,m,h,g,w=null,v=-1,y=-1,x=!0,E=!1;function L(n,e,o,s){if(n.forEach((function(n){t(n)})),r?r._id!==s._id&&(U(r),r=s):r=s,!m){m=e;let t=m;for(;t.parentNode!==document&&t.classList;){if(t.classList.contains("modal-body")){E=!0;break}t=t.parentNode}}if(d=new Map,f&&f.dispose(),f=new i(m),w||(u=new Map,l=new Map,w=n),y=-1,f.attachEventWithContext(document,"keydown",C,document),w&&(w.sort((function(t,n){return t.dataset.vindex-n.dataset.vindex})),h=function(t,n){if(E)return t;let e=t,o=window.getComputedStyle(e);for(;o.position!==n&&e.parentNode!==document;)e=e.parentNode,o=window.getComputedStyle(e);return e}(m,"absolute"),b(o&&!E),N())){const t=f.attachEvent(h,"focusin",(function(){t.dispose(),w[0].focus()}))}S(),g&&(g.parentNode.removeChild(g),g=null)}function b(t){x=t,p&&p.dispose();const n=document.querySelector(".column-chooser-exit-button");p=n?new e(n,null,m,!x):null,l.forEach((function(t){t.dispose()})),l=new Map,w.forEach((function(t){!function(t,n){let s=u.get(t.dataset.column);s||(s=new o(t,t.parentNode,z,".column-chooser-drag-icon-owner",T,E),s.onDragStart=_,s.onDrag=B,s.onDragCancel=R,s.onDropAnimationEnd=F,u.set(t.dataset.column,s));s.reset(),t.classList.remove("up"),t.classList.remove("down"),t.classList.remove("freeze");let c=l.get(t.dataset.column);c||(c=new e(t,".custom-control-input",n,E||!x),c.onFocus=k,c.onBlur=O,c.onClick=M,l.set(t.dataset.column,c));c.reset()}(t,h)}))}function N(){return x}function C(t){switch(N()||(b(!0),9===t.keyCode&&w[w.length-1].focus()),t.keyCode){case 32:y>=0&&(t.preventDefault(),w[y].click());break;case 38:t.preventDefault(),D(-1);break;case 40:t.preventDefault(),D(1)}}function D(t){if(!w||!u)return;y+=t,y=y<0?w.length-1:y,y%=w.length;const n=l.get(w[y].dataset.column);n&&n.focus()}function k(t){y=w.indexOf(t)}function O(t){y===w.indexOf(t)&&(y===w.length-1&&p&&p.focus(),y=-1)}function M(t){N()&&b(!1)}function j(t){return w.find((function(n,e,o){return function(t,n){const e=A(t);return!!e&&(e.top<=n&&n<=e.bottom)}(n,t.y)}))}function z(t){const n=j(t);return n?{item:n,relativeRect:A(n)}:null}function S(){if(a&&a.style){const t=u.get(a.dataset.column);t&&t.reset();const n=l.get(a.dataset.column);n&&n.reset(),v=-1,a.childNodes.forEach((function(t){t.style&&(t.style.visibility="")})),a=null}}function _(t){a=t,v=w.indexOf(a),w.forEach((function(t){t.blur(),t!==a&&t.classList.add("freeze")})),a.childNodes.forEach((function(t){t.style&&(t.style.visibility="hidden")}));const n=l.get(a.dataset.column);n&&n.stop()}function A(t){let n=d.get(t);if(n)return n;const e=s(t),o=T();return n=new c(e.x-o.x,e.y-o.y,e.width,e.height),d.set(t,n),n}function F(t,e){w.forEach((function(t){u.get(t.dataset.column).stop()})),g=m.cloneNode(!0),n(g),g.style["z-index"]=2e3,m.parentNode.appendChild(g),r.invokeMethodAsync("OnElementsExchange",t.dataset.column,e.dataset.column).catch((function(t){window.console.error(t)}))}function R(t){w.forEach((function(t){t.classList.remove("up"),t.classList.remove("down"),t.classList.remove("freeze")})),S()}function T(){const t=E?m.parentNode:m,n=s(t);return 0!==t.scrollTop?{x:n.x,y:n.y-t.scrollTop}:n.location}function q(t){l.get(t.dataset.column).updateStyleMetadata()}function B(t,n){if(!t)return;-1===v&&(v=w.indexOf(t));const e=j(n.centerOfDraggingObject);if(!e)return;const o=w.indexOf(e);let s=!1;w.forEach(v<o?function(t){a===t&&(s=!0),s?(q(t),t.classList.add("up")):t.classList.remove("up","down"),e===t&&(s=!1)}:v>o?function(t){e===t&&(s=!0),s?(q(t),t.classList.add("down")):t.classList.remove("up","down"),a===t&&(s=!1)}:function(t){t.classList.remove("up","down")})}function U(t){t._id===r._id&&(u.forEach((function(t){t.dispose()})),l.forEach((function(t){t.dispose()})),w=null,a=null,v=-1,m=null,d=null,u=null,l=null,r=null,f&&f.dispose(),f=null,g&&(g.parentNode.removeChild(g),g=null))}const W={init:L,dispose:U};export default W;export{U as dispose,L as init};
