import{B as e}from"./dom-a06f5987.js";import{d as t,r as s}from"./disposable-35c3c450.js";import{e as n,f as i}from"./dom-utils-d8c2ed7a.js";import{P as o}from"./dx-preloader-0d6c931c.js";let r;class a{constructor(){this.init_new_manager=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:GetNewManager"),this.keyPress=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:KeyPress"),this.clear=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:Clear"),this.paste=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:Paste"),this.getValue=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:GetValue"),this.setValue=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:SetValue"),this.setSelection=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:SetSelection"),this.disposeMaskManager=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:DisposeMaskManager"),this.updateProperties=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:UpdateProperties")}}class l{constructor(e){e.includes("\\")&&(e=e.split("\\").join("\\\\")),this.info=JSON.parse(e)}get selectionStart(){return this.info.selectionStart}get selectionEnd(){return this.info.selectionEnd}get value(){return this.info.value}get displayText(){return this.info.displayText}}class u{constructor(e,t){this.customWheelProcessing=!1,this.suppressFocusEvents=!1,this.inputElement=e,this.dotnetHelper=t}initializeEvents(e){const t=t=>{e.onKeyDown(t)},n=t=>{e.onKeyUp(t)},i=t=>{e.onClick(t)},o=t=>{e.onCut(t)},r=t=>{e.onPaste(t)},a=t=>{e.onDrop(t)},l=t=>{e.onFocus(t)},u=t=>{e.onFocusOut(t)},p=t=>{e.onWheel(t,e)};this.inputElement.addEventListener("keydown",t),this.inputElement.addEventListener("keyup",n),this.inputElement.addEventListener("click",i),this.inputElement.addEventListener("cut",o),this.inputElement.addEventListener("paste",r),this.inputElement.addEventListener("drop",a),this.inputElement.addEventListener("focus",l),this.inputElement.addEventListener("focusout",u),this.inputElement.addEventListener("wheel",p,{passive:!1}),s(this.inputElement,(()=>{e.inputElement.removeEventListener("keydown",t),e.inputElement.removeEventListener("keyup",n),e.inputElement.removeEventListener("click",i),e.inputElement.removeEventListener("cut",o),e.inputElement.removeEventListener("paste",r),e.inputElement.removeEventListener("drop",a),e.inputElement.removeEventListener("focus",l),e.inputElement.removeEventListener("focusout",u),e.inputElement.removeEventListener("wheel",p),e.disposeMaskManager()}))}disposeMaskManager(){}isInputValueHighlighted(){return 0===this.inputElement.selectionStart&&this.inputElement.selectionEnd===(this.inputElement.value?this.inputElement.value.length:0)}checkValidInsertion(e,t){return"Backspace"===e.key||"Delete"===e.key||"Home"===e.key||"Enter"===e.key||"End"===e.key||("ArrowUp"===e.key||"ArrowDown"===e.key)&&!t||"ArrowLeft"===e.key||"ArrowRight"===e.key||e.ctrlKey&&("a"===e.key||"z"===e.key)||!e.ctrlKey&&1===e.key.length}checkValidInput(){return!this.inputElement.disabled&&!this.inputElement.readOnly}canHandleMouseWheel(){return this.checkValidInput()&&document.activeElement===this.inputElement&&!this.customWheelProcessing}}class p extends u{constructor(e,t,s,n){super(e,t),this.managerId=-1,this.isWheelScrolling={timer:0},this.onDispose=new Array,this.maskProperties=s,this.onInputMode=n,this.customWheelProcessing=s.customWheelProcessing}initializeMonoMasks(e,t){return new Promise(((s,n)=>{this.maskProperties&&this.maskProperties.editMask&&0!==this.maskProperties.maskMode?(this.inputElement.value=e,this.displayPreloader(),void 0!==r?(this.initializeInternal(t),s()):(p.maskLoadingPromise||this.loadMasks(),p.maskLoadingPromise.then((()=>{this.initializeInternal(t),s()})))):n()}))}initializeInternal(s){t(this.inputElement),this.managerId=r.init_new_manager(this.maskProperties.maskMode,this.maskProperties.editMask,this.maskProperties.placeholder,this.maskProperties.lcid,this.maskProperties.flags,this.maskProperties.valueString,this.maskProperties.valueType,s),this.initializeEvents(this);const n=i(this.inputElement,".dxbs-spin-edit");n&&!e.MobileUI&&this.initializeSpinButtons(n,this),this.fadeOutPreloader(),this.inputElement.setAttribute("data-dx-client-mask-initialized","true")}initializeSpinButtons(e,t){const s=e.querySelectorAll("button:not(.dxbs-clear-btn)");if(s){const e=()=>{t.setSuppressFocusEvents(!0)},n=()=>{t.setSuppressFocusEvents(!1)};s.forEach((t=>{t.addEventListener("mousedown",e),t.addEventListener("focusout",n),this.onDispose.push((()=>{t.removeEventListener("mousedown",e),t.removeEventListener("focusout",n)}))}))}}setSuppressFocusEvents(e){this.suppressFocusEvents=e}loadMasks(){p.maskLoadingPromise||(p.maskLoadingPromise=new Promise(((e,t)=>{const s=document.createElement("script");s.src="_content/DevExpress.Blazor.Server.WebAssembly/dotnet.js",s.onload=function(){!function t(){window.MONO.mono_wasm_runtime_is_ready?(document.head.removeChild(s),r=new a,e(!0)):window.setTimeout(t,100)}()},document.head.appendChild(s)})))}displayPreloader(){const e=i(this.inputElement,".dxbs-input-group");if(!e)return;const t=e.querySelector(".dxbs-preloader-container"),s=o.create(t,this.inputElement);if(s){this.blockEvents(this.inputElement,s);let t=0;if(this.inputElement.value){const s=document.createElement("span");s.style.visibility="hidden",s.style.width="auto",s.style.position="fixed",s.innerHTML=this.inputElement.value,s.style.fontSize=getComputedStyle(this.inputElement).fontSize,e.append(s),t=s.clientWidth,s.remove()}s.display(t)}}blockEvents(e,t){function s(e){e.preventDefault(),e.stopPropagation()}const n=i(e,".dxbs-input-group");let o=[];n&&(o=n.querySelectorAll("button"),o&&o.forEach((e=>{e.addEventListener("click",s),e.addEventListener("mousedown",s),e.addEventListener("mouseup",s)}))),e.addEventListener("keydown",s),e.addEventListener("click",s),e.addEventListener("cut",s),e.addEventListener("paste",s),t.registerOnHideAction((function(){e.removeEventListener("keydown",s),e.removeEventListener("click",s),e.removeEventListener("cut",s),e.removeEventListener("paste",s),o&&o.forEach((e=>{e.removeEventListener("click",s),e.removeEventListener("mousedown",s),e.removeEventListener("mouseup",s)}))}))}fadeOutPreloader(){const e=i(this.inputElement,".dxbs-input-group");if(!e)return;const t=e.querySelector(".dxbs-preloader-container");o.remove(t)}applyMaskInfo(e,t,s=""){this.checkValidInput()&&(this.inputElement.value=s||e.displayText,t&&this.dotnetHelper&&this.dotnetHelper.invokeMethodAsync("SetValue",e.value)),this.inputElement.setAttribute("dx-mask-value",e.value),document.activeElement===this.inputElement&&this.inputElement.setSelectionRange(e.selectionStart,e.selectionEnd)}onKeyDown(t){if(e.AndroidMobilePlatform&&t.preventDefault(),!this.checkValidInsertion(t,this.maskProperties.customArrowsUpDownProcessing)||!this.checkValidInput()||e.AndroidMobilePlatform)return;t.preventDefault();const s=new l(r.keyPress(this.managerId,t.key,t.shiftKey,t.ctrlKey));this.applyMaskInfo(s,this.onInputMode||"Enter"===t.key),"ArrowLeft"!==t.key&&"ArrowRight"!==t.key&&"Home"!==t.key&&"End"!==t.key||(this.suppressFocusEvents=!0,this.inputElement.blur(),this.inputElement.focus(),this.suppressFocusEvents=!1)}onKeyUp(t){if(e.AndroidMobilePlatform){let e=t.key;229===t.keyCode&&(e=this.inputElement.value.substring(this.inputElement.selectionStart-1,this.inputElement.selectionStart));const s=new l(r.keyPress(this.managerId,e,!1,!1));this.applyMaskInfo(s,this.onInputMode||"Enter"===t.key)}else"ArrowUp"!==t.key&&"ArrowDown"!==t.key||this.dotnetHelper.invokeMethodAsync("SetValue",this.inputElement.getAttribute("dx-mask-value"))}onClick(e){if(!this.checkValidInput())return;const t=new l(r.setSelection(this.managerId,this.inputElement.selectionStart,this.inputElement.selectionEnd));this.inputElement.selectionStart===this.inputElement.selectionEnd&&this.applyMaskInfo(t,!1)}onCut(e){if(!this.checkValidInput())return;e.preventDefault(),document.execCommand("copy");const t=new l(r.clear(this.managerId,this.inputElement.selectionStart,this.inputElement.selectionEnd));this.applyMaskInfo(t,this.onInputMode)}onPaste(e){if(!this.checkValidInput())return;e.preventDefault();const t=e.clipboardData,s=null==t?void 0:t.getData("Text"),n=new l(r.paste(this.managerId,s));this.applyMaskInfo(n,this.onInputMode)}onDrop(e){e.preventDefault()}onFocus(e){if(this.isInputValueHighlighted()&&this.checkValidInput()){const e=new l(r.setSelection(this.managerId,this.inputElement.selectionStart,this.inputElement.selectionEnd));this.applyMaskInfo(e,!1)}}onFocusOut(e){if(!this.checkValidInput()||this.suppressFocusEvents)return;e.preventDefault();const t=new l(r.getValue(this.managerId));this.dotnetHelper.invokeMethodAsync("OnFocusLost_RemoteMask",t.value),this.applyMaskInfo(t,!1)}onWheel(e,t){if(!this.canHandleMouseWheel())return;e.preventDefault(),window.clearTimeout(this.isWheelScrolling.timer);const s=new l(r.keyPress(this.managerId,e.deltaY<0?"ArrowUp":"ArrowDown",!1,!1));this.applyMaskInfo(s,!1),this.isWheelScrolling.timer=setTimeout((function(){t.dotnetHelper.invokeMethodAsync("SetValue",t.inputElement.getAttribute("dx-mask-value"))}),500)}disposeMaskManager(){for(;this.onDispose.length>0;){const e=this.onDispose.pop();e&&e()}const e=i(this.inputElement,".dxbs-input-group");if(e){const t=e.querySelector(".dxbs-preloader-container");o.remove(t)}void 0!==r&&r.disposeMaskManager(this.managerId)}setValue(e,t,s){const n=new l(r.setValue(this.managerId,e,t));this.applyMaskInfo(n,!1,s)}updateMask(e,t){this.maskProperties=e;const s=new l(r.updateProperties(this.managerId,e.maskMode,e.editMask,e.placeholder,e.lcid,e.flags,e.valueString,e.valueType));this.applyMaskInfo(s,!1,t)}}p.maskLoadingPromise=null;class d extends u{constructor(e,t,s,n){super(e,t),this.customArrowsProcessing=s,this.customWheelProcessing=n}initialize(e){this.inputElement.value=e,this.initializeEvents(this)}onKeyDown(t){this.checkValidInsertion(t,this.customArrowsProcessing)&&this.checkValidInput()&&!e.AndroidMobilePlatform&&(t.preventDefault(),this.dotnetHelper.invokeMethodAsync("KeyDown",t.key,t.shiftKey,t.ctrlKey),"ArrowLeft"!==t.key&&"ArrowRight"!==t.key&&"Home"!==t.key&&"End"!==t.key||(this.suppressFocusEvents=!0,this.inputElement.blur(),this.inputElement.focus(),this.suppressFocusEvents=!1))}onKeyUp(t){if(e.AndroidMobilePlatform){let e=t.key;229===t.keyCode&&(e=this.inputElement.value.substring(this.inputElement.selectionStart-1,this.inputElement.selectionStart)),this.dotnetHelper.invokeMethodAsync("KeyDown",e,!1,!1)}else"ArrowUp"!==t.key&&"ArrowDown"!==t.key||this.customArrowsProcessing||(t.preventDefault(),this.dotnetHelper.invokeMethodAsync("KeyUp",t.key))}onClick(e){this.checkValidInput()&&this.dotnetHelper.invokeMethodAsync("SetSelection",this.inputElement.selectionStart,this.inputElement.selectionEnd)}onCut(e){this.checkValidInput()&&(e.preventDefault(),document.execCommand("copy"),this.dotnetHelper.invokeMethodAsync("Clear",this.inputElement.selectionStart,this.inputElement.selectionEnd))}onPaste(e){if(!this.checkValidInput())return;e.preventDefault();const t=e.clipboardData,s=null==t?void 0:t.getData("Text");this.dotnetHelper.invokeMethodAsync("Paste",s)}onDrop(e){e.preventDefault()}onFocus(e){this.checkValidInput()&&this.isInputValueHighlighted()&&this.dotnetHelper.invokeMethodAsync("SetSelection",this.inputElement.selectionStart,this.inputElement.selectionEnd)}onFocusOut(e){this.checkValidInput()&&!this.suppressFocusEvents&&(e.preventDefault(),this.dotnetHelper.invokeMethodAsync("OnFocusLost_LocalMask"))}onWheel(e,t){this.canHandleMouseWheel()&&(e.preventDefault(),this.dotnetHelper.invokeMethodAsync("OnMouseWheel",e.deltaY<0))}}const c=new Map;function h(e,t,s,n,i,o){return new Promise(((r,a)=>{let l=c.get(e);l||(l=new p(e,s,t,n),l.initializeMonoMasks(i,o).then((()=>{c.set(e,l),r()})).catch((()=>a())))}))}function m(e,t,s,n,i){let o=c.get(e);o||(o=new d(e,t,n,i),o.initialize(s),c.set(e,o))}function k(e,t,s,n){const i=c.get(e);i&&i.setValue(t,s,n)}function E(e,t,s){const n=c.get(t);n&&n.updateMask(e,s)}function v(e,t,s,n){e.value=t,document.activeElement===e&&e.setSelectionRange(s,n)}function y(e){if(e=n(e)){t(e);c.get(e)&&c.delete(e)}return Promise.resolve("ok")}const M={initMonoMasks:h,setValueToMonoMaskManager:k,initServerMasks:m,applyMaskParameters:v,updateRemoteMask:E,dispose:y};export default M;export{v as applyMaskParameters,y as dispose,h as initMonoMasks,m as initServerMasks,k as setValueToMonoMaskManager,E as updateRemoteMask};
