import{D as t,B as e}from"./dom-a06f5987.js";import{E as n}from"./evt-20927eae.js";import{T as i}from"./touch-2ca1b361.js";import{D as o,E as s,h as l,d as r,F as a,G as c,g as u,u as p,e as h,s as f}from"./dom-utils-69ea39c0.js";import{d,r as m}from"./disposable-35c3c450.js";import{L as g,h as y,u as v,T,c as C}from"./timer-562516a7.js";import{dxPopupModalTagName as A}from"./popupcomponents-2423c26d.js";const S={x:null,y:null,showCallout:!0,showTitle:!1,position:"right",className:"",classNames:{sysClassName:"dx-hint",contentElementClassName:"dxh-content",calloutElementClassName:"popover-arrow arrow",titleElementClassName:"dxh-title"},allowFlip:!0,allowShift:!0,offset:4};function x(e,n,i){i||(i=S),n.style.visibility="hidden",n.style.display="block",function(e,n){const i=t.getAbsolutePositionX(e),l=t.getAbsolutePositionY(e);o(n,i),s(n,l)}(e,n),I.updatePosition(e,n,i),n.style.visibility=""}class I{static getPositionClassName(t){let e="bs-popover-"+t.toLowerCase();return"right"===t?e+=" bs-popover-end":"left"===t&&(e+=" bs-popover-start"),e}static ensureCalloutPosition(e,n,i){const o=I.getPositionClassName(n),s=I.getPositionClassName(i);t.removeClassName(e,o),t.addClassName(e,s)}static isPositionHorizontal(t){return"left"===t||"right"===t}static ensureCalloutShift(t,e,n){const i=I.getCalloutElement(t,e.classNames);if(!i)return;const o=!this.isPositionHorizontal(e.position),s=o?t.offsetWidth:t.offsetHeight;i.style[o?"left":"top"]=I.limitCalloutPos(s/2-(o?n.x:n.y),s)}static limitCalloutPos(t,e){const n={min:15,max:e-15},i=t<n.min,o=t>n.max;o&&(t=n.max),i&&(t=n.min);let s=t+"px";return i&&o&&(s="50%"),s}static getCalloutElement(t,e){return t?t.getElementsByClassName(e.calloutElementClassName)[0]:null}static updatePosition(t,e,n){let i=10,o=!1;do{const s={w:e.offsetWidth,h:e.offsetHeight};I.updatePositionStep(t,e,n),o=s.w!==e.offsetWidth||s.h!==e.offsetHeight,i--}while(o&&i>0)}static updatePositionStep(t,e,n){const i=H.set(t,e,n);I.ensureCalloutPosition(e,n.position,i.flipPosition),I.ensureCalloutShift(e,n,i.shift)}}class b{constructor(t,e,n){this.targetElement=t,this.hintElement=e,this.options=n,this.position=n.position,this.calloutSize={width:0,height:0};const i=I.getCalloutElement(e,n.classNames);i&&(this.calloutSize.width=i.offsetWidth,this.calloutSize.height=i.offsetHeight),this.horizontal=new w(t,e,n,this.calloutSize,!0),this.vertical=new w(t,e,n,this.calloutSize,!1)}}class w{constructor(n,i,o,s,u){this.location=0,this.screen={min:0,max:0},this.screen.min=u?l():r();const p=e.WebKitTouchUI?window.innerWidth:c();this.screen.max=this.screen.min+(u?p:a()),this.target={min:0,max:0},this.target.min=u?t.getAbsolutePositionX(n):t.getAbsolutePositionY(n),this.target.max=this.target.min+(u?n.offsetWidth:n.offsetHeight),this.hintSize=u?i.offsetWidth:i.offsetHeight}}class H{static calcPosition(t,e,n){const i=new b(t,e,n),o=H.getPositionOrienation(i.position);n.allowFlip&&(o.horizontal?i.position=O.flipPositionIfRequired(i.horizontal,i.position):o.vertical&&(i.position=O.flipPositionIfRequired(i.vertical,i.position)));const s=H.getNotShiftedOffset(i),l={x:0,y:0};return n.allowShift&&(l.x=E.getShift(i.horizontal,o,s.x,0,!0),l.y=E.getShift(i.vertical,o,s.y,0,!1)),{location:{x:s.x+l.x,y:s.y+l.y},shift:l,flipPosition:i.position}}static getPositionOrienation(t){return{vertical:"bottom"===t||"top"===t,horizontal:"right"===t||"left"===t}}static getNotShiftedOffset(t){return H.getNotShiftedOffsetCore(t.position,{width:t.horizontal.target.max-t.horizontal.target.min,height:t.vertical.target.max-t.vertical.target.min},{width:t.horizontal.hintSize,height:t.vertical.hintSize},t.calloutSize)}static getNotShiftedOffsetCore(t,e,n,i){const o={x:0,y:0};return"top"===t?o.y-=n.height+i.height:"bottom"===t?o.y+=e.height+i.height:"left"===t?o.x-=n.width+i.width:"right"===t&&(o.x+=e.width+i.width),"top"!==t&&"bottom"!==t||(o.x+=e.width/2-n.width/2),"left"!==t&&"right"!==t||(o.y+=e.height/2-n.height/2),o}static set(e,n,i){const l=H.calcPosition(e,n,i),r={x:0,y:0},a=H.getPositionOrienation(l.flipPosition);a.horizontal&&(r.x=i.offset*l.location.x/Math.abs(l.location.x)),a.vertical&&(r.y=i.offset*l.location.y/Math.abs(l.location.y));const c=null!==i.x?i.x:t.getAbsolutePositionX(e)+l.location.x+r.x,u=null!==i.y?i.y:t.getAbsolutePositionY(e)+l.location.y+r.y;return o(n,c),s(n,u),{location:{x:-1,y:-1},flipPosition:l.flipPosition,shift:{x:l.shift.x,y:l.shift.y}}}}class O{static flipPositionIfRequired(t,e){return O.ensureFlipCore(t.screen,t.target,t.hintSize,e)}static getFlipPosition(t){return"bottom"===t?"top":"top"===t?"bottom":"right"===t?"left":"left"===t?"right":t}static ensureFlipCore(t,e,n,i){const o="bottom"===i||"right"===i,s="top"===i||"left"===i;let l=e.min-n-t.min;e.min-n>t.max&&(l=-1);let r=t.max-(e.max+n);e.max+n<t.min&&(r=-1);const a=l>=0,c=r>=0;if(!a&&!c)return i;if(s&&a)return i;if(o&&c)return i;return s&&!a&&l<r||o&&!c&&r<l?this.getFlipPosition(i):i}}class E{static getShift(t,e,n,i,o){let s=0;return!(e.horizontal&&o||e.vertical&&!o)&&(s=E.getShiftCore(t.screen,t.target,t.hintSize,n,i)),s}static getShiftCore(t,e,n,i,o){if(e.max<t.min+o||e.min>t.max-o)return 0;const s=e.min+i,l=e.min+i+n,r=s<t.min&&l>t.min,a=l>t.max&&s<t.max;if(r&&!a){return t.min-s}if(a&&!r){return t.max-n-s}return 0}}var D;!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(D||(D={}));class z{getContainerIndex(t){return z.getAttributeIntValue(t,"data-container-index",-1)}getFirstContainerIndex(t){return z.getAttributeIntValue(t,"data-first-container-index",-1)}getLastContainerIndex(t){return z.getAttributeIntValue(t,"data-last-container-index",-1)}getAppointmentFirstCellIndex(t){return z.getAttributeIntValue(t,"data-first-cell-index",-1)}getAppointmentLastCellIndex(t){return z.getAttributeIntValue(t,"data-last-cell-index",-1)}getAppointmentColumnsCount(t){return z.getAttributeIntValue(t,"data-columns-count",0)}setAppointmentColumnsCount(t,e){t.setAttribute("data-columns-count",e)}getAppointmentColumn(t){return z.getAttributeIntValue(t,"data-column",0)}setAppointmentColumn(t,e){t.setAttribute("data-column",e)}getAppointmentKey(t){return t.getAttribute("data-key")||""}getStart(t){const e=new Date(parseInt(t.getAttribute("data-start")||"")),n=e.getTime()+6e4*e.getTimezoneOffset();return new Date(n)}getEnd(t){const e=new Date(parseInt(t.getAttribute("data-end")||"")),n=e.getTime()+6e4*e.getTimezoneOffset();return new Date(n)}getDuration(t){return parseInt(t.getAttribute("data-duration")||"")}getAllDay(t){return""===t.getAttribute("data-allday")}getResourceKey(t){return t.getAttribute("data-resource")||""}static getAttributeIntValue(t,e,n){const i=t.getAttribute(e);return i?parseInt(i):n}}class P{static getVerticalAppointmentsContainer(t){return t.querySelectorAll(".dxbs-sc-vertical-apts")[0]}static getHorizontalAppointmentsContainer(t){return t.querySelectorAll(".dxbs-sc-horizontal-apts")[0]}static getHorizontalAppointments(t){const e=t.querySelectorAll(".dxbs-sc-horizontal-apt");return Array.from(e)}static getVerticalAppointments(t){const e=t.querySelectorAll(".dxbs-sc-vertical-apt");return Array.from(e)}static getHorizontalView(t){return t.querySelectorAll(".dxbs-sc-horizontal-view")[0]}static getTimeMarkerWrappers(t){return t.querySelectorAll(".dxbs-sc-time-marker-wrapper")}static getTimeMarkerContainer(t){return t.querySelectorAll(".dxbs-sc-time-marker")[0]}static getTimeMarkerImages(t){const e=t.querySelectorAll(".dxbs-sc-time-marker-image");return Array.from(e)}static getTimeMarkerLine(t){return t.querySelectorAll(".dxbs-sc-time-marker-line")[0]}static getTimeIndicatorContainer(t){return t.querySelectorAll(".dxbs-sc-time-indicator")[0]}static getAppointmentContainer(t){return u(t,"dxbs-sc-apt")}static getSelectedAppointment(t){return t.querySelectorAll(".dxbs-apt-selected")[0]}static getEditedAppointment(t){return t.querySelectorAll(".dxbs-apt-edited")[0]}static getCellSelectionContainer(t){return t.querySelectorAll(".dxsc-cell-selection")[0]}static getVerticalResourceHeaders(t){return t.querySelectorAll(".dxsc-v-resource-header")}static getResourcesViewport(t){return t.querySelectorAll(".dxbs-sc-resources-container")[0]}static getTimescaleViewport(t){return t.querySelectorAll(".dxbs-sc-headers-container")[0]}static getTimeCellsViewport(t){return t.querySelectorAll(".dxbs-sc-timecells-container")[0]}static getParentTimeCellsViewport(t){return u(t,"dxbs-sc-timecells-container")}static getHorizontalScrollSpacer(t){return t.querySelectorAll(".dxbs-sc-h-scroll-spacer")[0]}static getVerticalScrollSpacer(t){return t.querySelectorAll(".dxbs-sc-v-scroll-spacer")[0]}static isVerticalAppointment(e){return t.hasClassName(e,"dxbs-sc-vertical-apt")}static isHorizontalAppointment(e){return t.hasClassName(e,"dxbs-sc-horizontal-apt")}static getTimelineView(t){return t.querySelectorAll(".dxbs-sc-timeline")[0]}}P.Attr=new z;class V{constructor(t,e){this._element=t,this._cellSelector=e,this.containers=null,this.timeCells=null}get element(){return this._element}get cellSelector(){return this._cellSelector}getContainers(){if(!this.containers){const t=this.getTimeCells();this.containers={};for(let e,n=0;e=t[n];n++){const t=P.Attr.getContainerIndex(e);this.containers[t]||(this.containers[t]={cells:[]}),this.containers[t].cells.push(e)}}return this.containers}clearObjects(){const t=this.getTimeCells();for(let e,n=0;e=t[n];n++)this.clearObject(e)}clearObject(t){}getTimeCells(){return this.timeCells||(this.timeCells=this.element.querySelectorAll(this.cellSelector)),this.timeCells}getFirstContainer(){const t=this.getContainers();for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return t[e];return null}findCell(t){const e=this.getContainers();for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n))for(let i,o=0;i=e[n].cells[o];o++){const e=P.Attr.getStart(i),n=P.Attr.getEnd(i);if(e.valueOf()-t.valueOf()<=0&&t.valueOf()-n.valueOf()<0)return i}return null}findStartCell(t){const e=this.getContainers();for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n))for(let i,o=0;i=e[n].cells[o];o++){const e=P.Attr.getStart(i);if(t.valueOf()-e.valueOf()<=0)return i}return null}findEndCell(t){const e=this.getContainers();for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n))for(let i,o=0;i=e[n].cells[o];o++){const e=P.Attr.getEnd(i);if(t.valueOf()-e.valueOf()<=0)return i}return null}findCellByPos(t,e){const n=this.getTimeCells();for(let i,o=0;i=n[o];o++){const n=i.getBoundingClientRect();if(n.top<=e&&e<n.bottom&&n.left<=t&&t<n.right)return i}return null}}class M{constructor(t,e,n,i){this.id=t,this.views=e,this.interval=n,this.allDay=P.Attr.getAllDay(e[0]),this.resourceKey=P.Attr.getResourceKey(e[0]),this.dateTimeViewLayout=i,this.sourceView=this.views[0].cloneNode(!0),this.aptCont=this.views[0].parentElement}getStart(){return this.interval.start}getDuration(){return this.interval.duration}getEnd(){return L.dateIncreaseWithUtcOffset(this.getStart(),this.getDuration())}clearViews(){this.views.forEach((t=>{t.parentElement&&t.parentElement.removeChild(t)})),this.views=[]}static createItem(t,e,n,i){const o=M.getAppointmentInterval(e);return new M(t,e,o,o.duration>=L.DaySpan?n:i)}static getAppointmentInterval(t){const e=P.Attr.getStart(t[0]),n=P.Attr.getDuration(t[0]);return L.createInterval(e,n)}static createItems(t,e,n){const i={};for(let e,n=0;e=t[n];n++){const t=P.Attr.getAppointmentKey(e);i[t]||(i[t]=[]),i[t].push(e)}const o=[];for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&o.push(M.createItem(t,i[t],e,n));return o}}class L{static dateSubsWithTimezone(t,e){return t.valueOf()-e.valueOf()+6e4*(e.getTimezoneOffset()-t.getTimezoneOffset())}static truncToDate(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate())}static calculateDaysDifference(t,e){const n=L.truncToDate(t),i=L.truncToDate(e);return L.dateSubsWithTimezone(i,n)/L.DaySpan}static dateIncreaseWithUtcOffset(t,e){const n=L.dateIncrease(t,e),i=6e4*(n.getTimezoneOffset()-t.getTimezoneOffset());return L.dateIncrease(n,i)}static dateIncrease(t,e){return new Date(t.valueOf()+e)}static addTimeSpan(t,e){return new Date(t.valueOf()+e)}static toDayTime(t){return t.valueOf()-L.truncToDate(t).valueOf()}static getCellInterval(t){const e=P.Attr.getStart(t),n=P.Attr.getEnd(t);return L.createInterval(e,n.valueOf()-e.valueOf())}static createInterval(t,e){return{start:t,duration:e,isLongerOrEqualDay:e>=L.DaySpan}}}L.HalfHourSpan=18e5,L.DaySpan=864e5;class N{constructor(t,e){this.scheduler=t,this.dotnetHelper=e,this.appointmentInfo=null,this.sourceAppointmentInterval=null,this.interval=null,this.cellInterval=null,this.dateDiff=0,this.horizontalAppointmentDragged=!1,this.lastCellChanged=!1,this.initialPageY=0,this.initialTop=0,this.initialScrollTop=0,this.lastTop=0,this.lastCell=null}dragStart(t,e,n){this.appointmentInfo=t,this.sourceAppointmentInterval=L.createInterval(t.getStart(),t.getDuration()),this.cellInterval=L.getCellInterval(e.cell),this.dateDiff=t.getStart().valueOf()-this.cellInterval.start.valueOf();const i=this.appointmentInfo.views[0];this.horizontalAppointmentDragged=e.layoutType===D.Horizontal,this.initialTop=i.offsetTop,this.initialPageY=n.pageY,this.lastTop=this.initialTop,this.lastCell=e.cell,this.initialScrollTop=this.getViewportScrollTop(),this.dotnetHelper.invokeMethodAsync("OnAppointmentDragStart"),this.scheduler.skipCalculateAllAppointments=!0}drag(t,e){var n;if(!this.cellInterval||!this.appointmentInfo)return;this.lastCellChanged=!1,this.updateEditedAppointmentPosition(e);const i=t.cell;if(this.lastCellChanged=this.lastCell!==i,this.lastCell=i,t.layoutType===D.Horizontal&&!this.horizontalAppointmentDragged){const t=(null===(n=i.offsetParent)||void 0===n?void 0:n.getBoundingClientRect().top)||0;this.initialTop=e.clientY-t,this.initialPageY=e.pageY,this.initialScrollTop=this.getViewportScrollTop(i),this.lastTop=this.initialTop}const o=L.getCellInterval(i);if(this.cellInterval.start.valueOf()-o.start.valueOf()==0&&this.cellInterval.duration===o.duration){const t=P.Attr.getResourceKey(i);if(!this.appointmentInfo.resourceKey||this.appointmentInfo.resourceKey===t)return}if(o.isLongerOrEqualDay)this.sourceAppointmentInterval&&this.sourceAppointmentInterval.isLongerOrEqualDay&&this.cellInterval.isLongerOrEqualDay===o.isLongerOrEqualDay?this.appointmentInfo.interval=L.createInterval(L.addTimeSpan(o.start,this.dateDiff||0),this.appointmentInfo.interval.duration):(this.appointmentInfo.interval=o,this.appointmentInfo.allDay=!0);else{this.sourceAppointmentInterval&&this.appointmentInfo.interval.isLongerOrEqualDay&&(this.appointmentInfo.interval.duration=this.sourceAppointmentInterval.isLongerOrEqualDay?o.duration:this.sourceAppointmentInterval.duration);const t=this.dateDiff&&this.dateDiff<o.duration?L.addTimeSpan(o.start,this.dateDiff):o.start;this.appointmentInfo.interval=L.createInterval(t,this.appointmentInfo.interval.duration),this.appointmentInfo.allDay=!1}this.updateResource(i);const s=6e4*o.start.getTimezoneOffset()*-1;this.dotnetHelper.invokeMethodAsync("OnAppointmentDrag",L.addTimeSpan(this.appointmentInfo.getStart(),s),L.addTimeSpan(this.appointmentInfo.getEnd(),s),this.appointmentInfo.allDay,this.appointmentInfo.resourceKey),this.cellInterval=o}resize(t,e){if(!this.appointmentInfo||!this.cellInterval)return;const n=L.getCellInterval(t);if(this.cellInterval.start.valueOf()-n.start.valueOf()==0&&this.cellInterval.duration===n.duration||this.cellInterval.isLongerOrEqualDay!==n.isLongerOrEqualDay)return;const i=this.cellInterval.start.valueOf()-n.start.valueOf();e&&this.dateDiff?this.appointmentInfo.interval=L.createInterval(L.addTimeSpan(n.start,this.dateDiff),this.appointmentInfo.interval.duration+i):this.appointmentInfo.interval.duration-=i,this.updateResource(t);const o=6e4*n.start.getTimezoneOffset()*-1;this.dotnetHelper.invokeMethodAsync("OnAppointmentDrag",L.addTimeSpan(this.appointmentInfo.getStart(),o),L.addTimeSpan(this.appointmentInfo.getEnd(),o),this.appointmentInfo.allDay,this.appointmentInfo.resourceKey),this.cellInterval=n}dragEnd(){this.dotnetHelper.invokeMethodAsync("OnAppointmentDragEnd"),this.scheduler.skipCalculateAllAppointments=!1}updateEditedAppointmentPosition(e){const n=P.getEditedAppointment(this.scheduler);if(!n||!this.lastCell)return;if(!t.hasClassName(n,"dxbs-sc-horizontal-apt"))return void(this.horizontalAppointmentDragged=!1);let i=!1;if(this.horizontalAppointmentDragged||(this.initialTop-=n.offsetHeight/2,this.lastTop=this.initialTop,this.horizontalAppointmentDragged=!0,i=!0),e){const t=this.getViewportScrollTop(),n=e.pageY-this.initialPageY+(t-this.initialScrollTop);this.lastTop=this.initialTop+n,i=i||0!==n}if(i||this.lastCellChanged){const t=this.lastCell.offsetTop+1;this.lastTop=Math.min(this.lastTop,t+this.lastCell.offsetHeight-n.offsetHeight-2),this.lastTop=Math.max(t,this.lastTop)}n.style.top=this.lastTop+"px",n.style.zIndex="1000"}updateResource(t){this.appointmentInfo&&this.appointmentInfo.resourceKey&&(this.appointmentInfo.resourceKey=P.Attr.getResourceKey(t))}getViewportScrollTop(t){const e=t||this.lastCell;if(!e)return 0;const n=P.getParentTimeCellsViewport(e);return(null==n?void 0:n.scrollTop)||0}}class k{constructor(t,e){this.scheduler=t,this.dotnetHelper=e,this.interval=null,this.direction=null}start(t){this.interval=L.getCellInterval(t);const e=this.interval.start,n=L.dateIncreaseWithUtcOffset(e,this.interval.duration),i=P.Attr.getResourceKey(t),o=6e4*e.getTimezoneOffset()*-1;this.dotnetHelper.invokeMethodAsync("OnCellSelectionStart",L.addTimeSpan(e,o),L.addTimeSpan(n,o),k.isAllDayCell(t),i)}resizeTo(t){if(!this.interval)return;const e=L.getCellInterval(t),n=e.start.valueOf()-this.interval.start.valueOf();if(0===n&&this.interval.duration===e.duration)return;n<0&&this.interval.duration===e.duration?this.direction="top":n>0&&this.interval.duration===e.duration&&(this.direction="bottom"),"bottom"===this.direction?this.interval.duration=n+e.duration:"top"===this.direction&&(this.interval.start=e.start,this.interval.duration+=-1*n);const i=this.interval.start,o=L.dateIncreaseWithUtcOffset(i,this.interval.duration),s=P.Attr.getResourceKey(t),l=6e4*i.getTimezoneOffset()*-1;this.dotnetHelper.invokeMethodAsync("OnCellSelectionResize",L.addTimeSpan(i,l),L.addTimeSpan(o,l),k.isAllDayCell(t),s)}end(){this.dotnetHelper.invokeMethodAsync("OnCellSelectionEnd")}static isAllDayCell(e){return t.hasClassName(e,"dxbs-sc-all-day-area")}}class q{constructor(t,e,n){this.scheduler=t,this.dotnetHelper=e,this.viewport=P.getTimeCellsViewport(this.scheduler),this.callback=n,this.timerId=-1,this.lastCoords={},this.shiftX=0,this.shiftY=0,this.scrollingInProgress=!1}scrollTo(t){if(!this.viewport)return;this.lastCoords=t,this.shiftX=0,this.shiftY=0;const e=this.viewport.getBoundingClientRect();if(t.clientX-e.left<=50?this.shiftX=-8:e.right-t.clientX<=50&&(this.shiftX=8),t.clientY-e.top<=50?this.shiftY=-8:e.bottom-t.clientY<=50&&(this.shiftY=8),this.shiftX||this.shiftY){if(-1===this.timerId){const t=this.scrollingInProgress?20:500;this.timerId=setTimeout(this.onTimeout.bind(this),t)}}else this.end()}onTimeout(){this.scrollingInProgress=!0,this.timerId=-1,this.viewport.scrollLeft+=this.shiftX,this.viewport.scrollTop+=this.shiftY,setTimeout((()=>this.callback(this.lastCoords)))}end(){this.scrollingInProgress=!1,-1!==this.timerId&&(clearTimeout(this.timerId),this.timerId=-1)}}class R{constructor(){this.TIMEOUT=6e4,this.subscriptions=[],this.timerId=-1}subscribe(t,e){if(-1===this.getSubscriptionIndex(t)){this.subscriptions.push({scheduler:t,updateAction:e}),-1===this.timerId&&this.startTimer()}}unsubscribe(t){const e=this.getSubscriptionIndex(t);-1!==e&&this.unsubscribeByIndex(e)}unsubscribeByIndex(t){this.subscriptions.splice(t,1)}getSubscriptionIndex(t){for(let e,n=0;e=this.subscriptions[n];n++)if(e.scheduler===t)return n;return-1}startTimer(){this.timerId=setTimeout(this.onTimeout.bind(this),this.TIMEOUT)}onTimeout(){for(let t,e=0;t=this.subscriptions[e];e++)if(R.isElementValid(t.scheduler))try{t.updateAction()}catch(t){}else this.unsubscribeByIndex(e),e--;this.startTimer()}static isElementValid(t){for(;null!=t;){if("BODY"===t.tagName)return!0;t=t.parentNode}return!1}}const Y="none",K="drag",W="resizeTop",F="resizeBottom",j="resizeSelection",B=A.toUpperCase();function X(o,s,l,r){let a=o;if(a&&(a.appointmentToolTipElement&&d(a.appointmentToolTipElement),a.elementContentSizeSubscription&&p(a.elementContentSizeSubscription),ct.unsubscribe(a)),a=h(a),!a)return Promise.reject("failed");a.appointmentToolTipElement=h(l),a.settings=s,a.mouseMoveHandlerState||(a.mouseMoveHandlerState=Y),a.hDateTimeViewLayout=new V(a,".dxbs-sc-all-day-area, .dxbs-sc-horizontal-view .dxbs-sc-time-cell"),a.vDateTimeViewLayout=new V(a,".dxbs-sc-vertical-view .dxbs-sc-time-cell");let c=P.getHorizontalAppointments(a),u=P.getVerticalAppointments(a);if(a.appointmentInfos=M.createItems(c,a.hDateTimeViewLayout,a.vDateTimeViewLayout),a.appointmentInfos=a.appointmentInfos.concat(M.createItems(u,a.hDateTimeViewLayout,a.vDateTimeViewLayout)),a.skipCalculateAllAppointments){const e=e=>{const n=[];for(let i,o=0;i=e[o];o++)t.hasClassName(i,"dxbs-apt-edited")&&n.push(i);return n};return c=e(c),u=e(u),I(c,u,!1),a.dragHelper&&c.length>0&&a.dragHelper.updateEditedAppointmentPosition(),Promise.resolve("ok")}function A(){I(c,u,!0),function(){if(!a.appointmentToolTipElement)return;const e=P.getSelectedAppointment(a),n=a.lastMouseUpEventInfo,i=n&&n.appointment,o=e&&i&&P.Attr.getAppointmentKey(i)===P.Attr.getAppointmentKey(e)?i:e;if(o){const e=function(e,n,i){const o=e.getBoundingClientRect(),s=i.getBoundingClientRect();S.position=t.hasClassName(n,"dxsc-tooltip")?o.right-s.right>370?"right":s.left-o.left>370?"left":s.top-o.top>370?"top":"bottom":o.right-s.right>450?"right":s.left-o.left>450?"left":"auto";return S}(a,a.appointmentToolTipElement,o);x(o,a.appointmentToolTipElement,e)}}(),b()}function I(t,n,i){a.hDateTimeViewLayout.clearObjects(),G(a.hDateTimeViewLayout.getTimeCells(),t),G(a.vDateTimeViewLayout.getTimeCells(),n);const o=a.hDateTimeViewLayout.getContainers();i?function(t,n){e.Firefox&&function(t){const e=P.getHorizontalView(t);t.oldHViewMinHeight=e.style.minHeight;let n=e.getBoundingClientRect().height;n=Math.round(100*n)/100,e.style.minHeight=n+"px"}(t);const i=function(t,e){const n={};for(const i in e){if(!Object.prototype.hasOwnProperty.call(e,i))continue;const o=_(e[i].cells[0]),s=st(t,o);s&&(s.style.height="",null==n[o]?n[o]={element:s,height:0,minHeight:0,lastContainerIndex:i}:n[o].lastContainerIndex=i)}for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t].minHeight=n[t].element.offsetHeight);return n}(t,n);for(const t in n){if(!Object.prototype.hasOwnProperty.call(n,t))continue;let e=0;const o=n[t].cells;for(let t,n=0;t=o[n];n++){J(t);const n=Z(t);n>e&&(e=n)}const s=o[0];let l=e?e+15:0;s.style.height="",l=Math.max(s.offsetHeight,l);const r=i[_(s)];r&&(r.lastContainerIndex===t&&(l=Math.max(r.minHeight-r.height,l)),r.height+=l),s.style.height=l+"px"}for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&(i[t].element.style.height=i[t].height+"px");e.Firefox&&function(t){const e=P.getHorizontalView(t);e.style.minHeight=t.oldHViewMinHeight}(t)}(a,o):function(t){for(const e in t){if(!Object.prototype.hasOwnProperty.call(t,e))continue;const n=t[e].cells;for(let t,e=0;t=n[e];e++)J(t)}}(o),function(t){for(let e,n=0;e=t[n];n++)tt(e)}(n),i&&function(t){const e=P.getTimeCellsViewport(t);if(!e)return;let n=0;e.scrollWidth!==e.offsetWidth&&(n=e.offsetHeight-e.clientHeight);let i=0;e.scrollHeight!==e.offsetHeight&&(i=e.offsetWidth-e.clientWidth);const o=P.getHorizontalScrollSpacer(t);o&&n&&(o.style.height=n+"px");const s=P.getVerticalScrollSpacer(t);s&&i&&(s.style.width=i+"px");o&&(o.style.display=n?"block":"");s&&(s.style.display=i?"block":"")}(a)}function b(){P.getTimelineView(a)?function(t,e){const n=P.getTimeMarkerImages(t),i=P.getTimeMarkerLine(t);if(!n.length||!i||!e)return;const o=lt(),s=e.cells[e.cells.length-1],l=P.Attr.getStart(e.cells[0]),r=P.Attr.getEnd(s).valueOf()-l.valueOf(),a=at(o,l)/r;if(a>0&&a<1){n.forEach((t=>{t.style.display="unset"})),i.style.display="unset";const t=Math.round(1e4*a)/100,e=i.offsetWidth/2,o=`calc(${t}% - ${n[0].offsetWidth/2}px)`;n.forEach((t=>{t.style.left=o})),i.style.left=`calc(${t}% - ${e}px)`}else n.forEach((t=>{t.style.display="none"})),i.style.display="none"}(a,a.hDateTimeViewLayout.getFirstContainer()):function(t,e){const n=lt(),i=(s=n,new Date(s.getFullYear(),s.getMonth(),s.getDate())),o=function(t){const e=[],n=P.getTimeMarkerWrappers(t);for(let t,i=0;t=n[i];i++){const n={wrapper:t,timeMarker:P.getTimeMarkerContainer(t),timeIndicator:P.getTimeIndicatorContainer(t),firstContainerIndex:P.Attr.getFirstContainerIndex(t),lastContainerIndex:P.Attr.getLastContainerIndex(t),startFromContainer:i>0};e.push(n)}return e}(t);var s;if(0===o.length)return;for(let s,l=0;s=o[l];l++)it(s,t,e,i,n)}(a,a.vDateTimeViewLayout.getTimeCells())}function w(e){e&&(t.addClassName(e,"dxbs-apt-selected"),r.invokeMethodAsync("OnAppointmentSelect",P.Attr.getAppointmentKey(e)))}function H(t){return a.appointmentInfos.filter((e=>e.id===t))[0]}function O(e){if(y("TouchStart")||2===e.button)return void(2===e.button&&n.preventEventAndBubble(e));const i=e.srcElement,o=P.getAppointmentContainer(i);o?($(o)||w(o),a.settings.allowEditAppointment&&(t.hasClassName(i,"dxsc-top-handle")||function(e){return t.hasClassName(e,"dxsc-left-handle")}(i)?a.mouseMoveHandlerState=W:function(e){return t.hasClassName(e,"dxsc-bottom-handle")}(i)||function(e){return t.hasClassName(e,"dxsc-right-handle")}(i)?a.mouseMoveHandlerState=F:v((function(){a.mouseMoveHandlerState=K}),"drag",50,!0))):a.appointmentToolTipElement||a.settings.allowCreateAppointment&&U(i)&&(a.cellSelectionHelper=new k(a,r),a.cellSelectionHelper.start(e.srcElement),a.mouseMoveHandlerState=j)}function E(t){a.mouseMoveHandlerState!==Y&&(0!==t.buttons?(a.throttledDrag||(a.throttledDrag=T.throttle(D,20)),a.throttledDrag(t)):z(t))}function D(t){const e=ot(a,t.clientX,t.clientY);if(e)if(a.autoScrollHelper||(a.autoScrollHelper=new q(a,r,D)),a.autoScrollHelper.scrollTo(t),a.mouseMoveHandlerState===j&&a.cellSelectionHelper)a.cellSelectionHelper.resizeTo(e.cell);else{const n=function(){const t=P.getSelectedAppointment(a);return t?H(P.Attr.getAppointmentKey(t)):null}();n&&(a.mouseMoveHandlerState!==K&&a.mouseMoveHandlerState!==W&&a.mouseMoveHandlerState!==F||(a.dragHelper||(a.dragHelper=new N(a,r),a.dragHelper.dragStart(n,e,t)),a.mouseMoveHandlerState===K?a.dragHelper.drag(e,t):a.dragHelper.resize(e.cell,a.mouseMoveHandlerState===W)))}}function z(t){const e=t;if(y("TouchEnd")||e&&2===e.button)return void(2===e.button&&n.preventEventAndBubble(t));const i=P.getAppointmentContainer(t.srcElement);a.dragHelper||a.cellSelectionHelper?(a.dragHelper?(a.dragHelper.dragEnd(),a.dragHelper=null):a.cellSelectionHelper&&(a.cellSelectionHelper.end(),a.cellSelectionHelper=null),a.autoScrollHelper&&(a.autoScrollHelper.end(),a.autoScrollHelper=null)):a.settings.showAppointmentTooltip&&i&&!y("skipToolTip")&&(r.invokeMethodAsync("ShowAppointmentToolTip"),v((()=>{}),"skipToolTip",300,!1)),C("drag"),a.lastMouseUpEventInfo=i?{appointment:i}:{},a.mouseMoveHandlerState=Y}function L(t){v((()=>{}),"TouchStart",300,!0);w(P.getAppointmentContainer(t.srcElement))}function R(t){const e=t.srcElement,n=P.getAppointmentContainer(e);if(n){const e=t.touches[0],i=ot(a,e.clientX,e.clientY),o=H(P.Attr.getAppointmentKey(n));if(i){const t=new N(a,r);a.dragHelper=t,t.dragStart(o,i,e)}}else if(U(e)&&!a.appointmentToolTipElement){const t=new k(a,r);a.cellSelectionHelper=t,t.start(e)}}function X(t){if(!a.dragHelper&&!a.cellSelectionHelper)return;const e=t.touches[0],i=ot(a,e.clientX,e.clientY);i&&(a.dragHelper?a.dragHelper.drag(i,e):a.cellSelectionHelper&&a.cellSelectionHelper.resizeTo(i.cell)),n.preventEventAndBubble(t)}function Q(t){z(t),v((function(){}),"TouchEnd",300,!0)}function et(t){const e=P.getTimeCellsViewport(a),n=P.getResourcesViewport(a);n&&(n.scrollTop=e.scrollTop);const i=P.getTimescaleViewport(a);i&&(i.scrollLeft=e.scrollLeft)}return function(t,e,n){g.attachEventToElement(t,"mousedown",O,null),g.attachEventToElement(t,"mouseup",z,null),g.attachEventToElement(t,"mousemove",E,null),g.attachLongTabEventToElement(t,R),g.attachEventToElement(t,"touchstart",L,null),g.attachEventToElement(t,"touchmove",X,null),g.attachEventToElement(t,"touchend",Q,null),e&&(e.toolTipLostFocusHandler=t=>{const i=P.getAppointmentContainer(t.srcElement);return(!i||!$(i))&&function(t,e,n,i){return function(t,e,n){let i=t.target;for(;i;){if(i===e||i.tagName===B)return!1;i=i.parentElement}n&&n();return!0}(t,e,(function(){e&&"string"!=typeof e&&"none"!==e.style.display&&i.invokeMethodAsync(n)}))}(t,e,"OnAppointmentToolTipLostFocus",n)},document.addEventListener(i.touchMouseDownEventName,e.toolTipLostFocusHandler),m(e,(()=>{document.removeEventListener(i.touchMouseDownEventName,e.toolTipLostFocusHandler)})));const o=P.getTimeCellsViewport(t);o&&!o.scrollHandler&&(o.scrollHandler=et,o.addEventListener("scroll",o.scrollHandler));t.elementContentSizeSubscription=f(t,A),ct.subscribe(t,b)}(a,a.appointmentToolTipElement,r),Promise.resolve("ok")}function U(e){return t.hasClassName(e,"dxbs-sc-all-day-area")||t.hasClassName(e,"dxbs-sc-time-cell")}function $(e){return t.hasClassName(e,"dxbs-apt-selected")}function _(t){return P.Attr.getResourceKey(t)}function G(t,e){const n={};for(let e,i=0;e=t[i];i++){e.intersects=[];const t=P.Attr.getContainerIndex(e);n[t]||(n[t]=[]),n[t].push(e)}for(let t,i=0;t=e[i];i++){const e=P.Attr.getContainerIndex(t),i=P.Attr.getAppointmentFirstCellIndex(t),o=P.Attr.getAppointmentLastCellIndex(t);if(n[e]){t.firstCell=n[e][i],t.lastCell=n[e][o],t.info={cellCount:o-i+1};for(let s=i;s<=o;s++){et(n[e][s],t)}}}}function J(e){const n=function(t){return t.intersects.filter((t=>void 0!==t.info.calculatedTop)).sort(((t,e)=>t.info.calculatedTop-e.info.calculatedTop))}(e),i=function(t){return t.intersects.filter((t=>void 0===t.info.calculatedTop)).sort(((t,e)=>{const n=e.info.cellCount-t.info.cellCount;return n||P.Attr.getStart(t).valueOf()-P.Attr.getStart(e).valueOf()}))}(e);let o=e.offsetTop;if(e.lastElementChild&&t.hasClassName(e.lastElementChild,"dxsc-date-cell-head")){const t=window.getComputedStyle(e).paddingTop;o+=e.lastElementChild.offsetHeight+parseInt(t)}let s=null;do{s&&(o=s.info.calculatedTop+s.offsetHeight,s=null);let t=-1;for(;n.length&&-1===t;){const e=n[0];e.info.calculatedTop>o?(s=e,t=e.info.calculatedTop-o):o=e.info.calculatedTop+e.offsetHeight,n.shift()}let e=0;for(;e<i.length;){const n=i[e];n.info.precalculated||(Q(n),n.info.precalculated=!0);const s=n.offsetHeight;-1===t||s<=t?(n.info.calculatedTop=o,n.style.top=o+"px",o+=s,-1!==t&&(t-=s),i.splice(e,1)):e++}}while(i.length)}function Q(t){t.style.height="";const e=t;t.style.left=e.firstCell.offsetLeft+"px",t.style.width=e.lastCell===e.firstCell?nt(e.firstCell)+"px":e.lastCell.offsetLeft-e.firstCell.offsetLeft+nt(e.lastCell)+"px",t.style.top="-10000px",t.style.display=""}function Z(t){let e=-1,n=null;return t.intersects.forEach((t=>{t.info.calculatedTop>e&&(e=t.info.calculatedTop,n=t)})),n?e-t.offsetTop+n.offsetHeight:0}function tt(t){const e=P.Attr.getAppointmentColumn(t),n=t.firstCell.offsetWidth/P.Attr.getAppointmentColumnsCount(t);t.style.top=t.firstCell.offsetTop+"px",t.style.left=t.firstCell.offsetLeft+n*e+"px",t.style.width=n-10+"px",t.style.height=t.lastCell.offsetTop+t.lastCell.offsetHeight-t.firstCell.offsetTop+"px",t.style.display=""}function et(t,e){const n=t.intersects;n.findIndex((t=>P.Attr.getAppointmentKey(t)===P.Attr.getAppointmentKey(e)))<0&&n.push(e)}function nt(t){return Math.floor(t.getBoundingClientRect().width)}function it(t,e,n,i,o){const s=t.wrapper,l=function(t,e,n,i){const o=[];for(let s,l=0;s=t[l];l++)P.Attr.getContainerIndex(s)<n||P.Attr.getContainerIndex(s)>i||e.valueOf()-P.Attr.getStart(s).valueOf()>=0&&P.Attr.getEnd(s).valueOf()-e.valueOf()>0&&o.push(s);return o}(n,o,t.firstContainerIndex,t.lastContainerIndex);if(!l.length)return void(s.style.display="none");s.style.display="";const r=t.timeMarker,a=t.timeIndicator,c=r.offsetHeight/2,u=l[0].offsetLeft;let p=0;if(t.startFromContainer){const e=function(t,e){for(let n,i=0;n=t[i];i++)if(P.Attr.getContainerIndex(n)===e)return n;return null}(n,t.firstContainerIndex);e&&(p=e.offsetLeft===u?u-c:e.offsetLeft)}const h=Math.floor(function(t,e,n){const i=function(t,e){const n=t,i=at(e,n);let o=Math.abs(i)%864e5;i<0&&(o=864e5-o);return function(t,e){const n=rt(t,e),i=6e4*(n.getTimezoneOffset()-t.getTimezoneOffset());return rt(n,i)}(n,o)}(n,t),o=P.Attr.getStart(e),s=P.Attr.getEnd(e),l=at(i,o);return e.offsetTop+e.offsetHeight*l/(s.valueOf()-o.valueOf())}(o,l[0],i));if(r.style.top=h-c+"px",r.style.left=p+"px",r.style.width=u-p+c+1+"px",(f=s)&&"none"!==f.style.display){let t=0;for(let e,n=0;e=l[n];n++)t+=e.offsetWidth;a.style.top=h-1+"px",a.style.width=t+"px",a.style.left=u+"px"}var f}function ot(t,e,n){const i=t;let o=D.Vertical,s=i.vDateTimeViewLayout.findCellByPos(e,n);return s||(s=i.hDateTimeViewLayout.findCellByPos(e,n),o=D.Horizontal),s?{cell:s,layoutType:o}:null}function st(t,e){if(""===e)return null;const n=P.getVerticalResourceHeaders(t);for(let t,i=0;t=n[i];i++)if(_(t)===e)return t;return null}function lt(){const t=(new Date).getTime();return new Date(t)}function rt(t,e){return new Date(t.valueOf()+e)}function at(t,e){return t.valueOf()-e.valueOf()+6e4*(e.getTimezoneOffset()-t.getTimezoneOffset())}const ct=new R;function ut(e,n){v((()=>{t.addClassName(e,"dx-loading")}),"loading",300,!1)}function pt(e,n){t.removeClassName(e,"dx-loading"),C("loading")}function ht(t){return(t=h(t))&&(d(t),ct.unsubscribe(t)),Promise.resolve("ok")}const ft={init:X,dispose:ht,showLoading:ut,hideLoading:pt};export default ft;export{ht as dispose,pt as hideLoading,X as init,ut as showLoading};
