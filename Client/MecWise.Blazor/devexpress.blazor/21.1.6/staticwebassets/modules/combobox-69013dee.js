import{k as e}from"./key-643beca5.js";import{T as t}from"./touch-2ca1b361.js";import{d as o,r as n}from"./disposable-35c3c450.js";import{getDropDownElement as s,onOutsideClick as r,isDropDownVisible as i}from"./dropdowns-1c4b4bd4.js";import{e as a,a as d,b as c}from"./dom-utils-69ea39c0.js";import{scrollToFocusedItem as u,getParametersForVirtualScrollingRequest as m}from"./grid-2d85ac50.js";import{n as l,i as f,a as p}from"./keyboard-444ee1a1.js";import"./dom-a06f5987.js";import"./popup-utils-ba54a763.js";import"./focus-utils-9a432d39.js";import"./dragAndDropUnit-e1f6550e.js";import"./evt-20927eae.js";import"./column-resize-5f24b124.js";import"./dx-style-helper-b4c313f5.js";const v=window.console;function y(e){const t=s(e);u(t)}function E(e){e=a(e),document.activeElement===e&&C(e)}function b(e,t){e.dataset.timerId&&(clearTimeout(parseInt(e.dataset.timerId)),delete e.dataset.timerId),t||setTimeout((function(){b(e,!0)}),100)}function C(e){e&&e.dataset.focusedClass&&(e.className=e.dataset.focusedClass)}function k(t,o,n,s,r){l(t)&&t.preventDefault();(function(t){const o=t.keyCode===e.KeyCode.Esc||t.keyCode===e.KeyCode.Enter;return f(t)||p(t)||o})(t)&&!t.repeat&&function(e,t,o,n){const s=e.target.value;if(o&&n){const n=o.querySelector(".dxgvCSD");n&&(o=n);const r=m(o);t.invokeMethodAsync("ComboBoxWithVirtualScrollingOnKeyDown",s,e.keyCode,e.altKey,e.ctrlKey,r.requestScrollState.itemHeight,r.requestScrollState.scrollTop,r.requestScrollState.scrollHeight)}else t.invokeMethodAsync("ComboBoxOnKeyDown",s,e.keyCode,e.altKey,e.ctrlKey)}(t,o,n,r)}function L(e,t,o){if(!t)return;const n=(new Date).getTime();t.dataset.lastLostFocusTime&&n-parseInt(t.dataset.lastLostFocusTime)<300&&!o||(t.dataset.lastLostFocusTime=String((new Date).getTime()),e.invokeMethodAsync("OnComboBoxLostFocus",t.value).catch((function(e){c(t)||v.error(e)})))}function g(c,u,m){const f=a(c);if(!f)return Promise.reject("failed");o(f);const p=u.filteringEnabled,v=a(u.inputElement),y=s(f),E=y,g=e=>k(e,m,E,0,u.virtualScrollingEnabled),j=t=>function(t,o){l(t)&&(t.preventDefault(),t.keyCode!==e.KeyCode.Up&&t.keyCode!==e.KeyCode.Down||o.invokeMethodAsync("OnComboBoxArrowKeyUp",t.keyCode===e.KeyCode.Up))}(t,m),w=e=>function(e,t,o){o&&t.invokeMethodAsync("OnComboBoxProcessFiltering",e.target.value)}(e,m,p),h=e=>function(e,t){C(e.target)}(e),S=e=>function(e,t,o){const n=e.target;b(n,!0);const s=setTimeout((()=>{if(delete n.dataset.timerId,function(e){e&&e.dataset.bluredClass&&(e.className=e.dataset.bluredClass)}(n),document.activeElement!==n&&o.dataset.disposeId)try{L(t,n,!1)}catch(e){}}),200);n.dataset.timerId=String(s)}(e,m,f),I=e=>b(v,!1),K=e=>{r(e,f,(function(){d(f)||o(f);const e=document.activeElement===v,t=Number(v.dataset.timerId)>0,n=y&&i(y);b(v,!1),(e||t||n)&&L(m,v,!0)}))};return v.addEventListener("keydown",g),v.addEventListener("keyup",j),v.addEventListener("focus",h),v.addEventListener("blur",S),v.addEventListener("input",w),f.addEventListener("mousedown",I),document.addEventListener(t.touchMouseDownEventName,K),n(f,(function(){v.removeEventListener("keydown",g),v.removeEventListener("keyup",j),v.removeEventListener("focus",h),v.removeEventListener("blur",S),v.removeEventListener("input",w),f.removeEventListener("mousedown",I),document.removeEventListener(t.touchMouseDownEventName,K)})),Promise.resolve("ok")}function j(e){return(e=a(e))&&o(e),Promise.resolve("ok")}const w={init:g,dispose:j,prepareInputIfFocused:E,scrollToSelectedItem:y};export default w;export{j as dispose,g as init,E as prepareInputIfFocused,y as scrollToSelectedItem};
