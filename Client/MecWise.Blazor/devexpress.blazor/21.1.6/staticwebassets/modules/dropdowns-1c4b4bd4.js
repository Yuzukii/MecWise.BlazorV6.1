import{D as t}from"./dom-a06f5987.js";import{k as e}from"./key-643beca5.js";import{T as n}from"./touch-2ca1b361.js";import{i as o,c as i,e as s,g as r,s as c,a as l,b as a,R as u}from"./dom-utils-69ea39c0.js";import{d,r as h}from"./disposable-35c3c450.js";import{scrollToFocusedItem as f}from"./grid-2d85ac50.js";import{s as m,g as p,a as g}from"./popup-utils-ba54a763.js";import{initFocusHidingEvents as w}from"./focus-utils-9a432d39.js";import{g as v,a as y,P as b,E as x,b as C}from"./dragAndDropUnit-e1f6550e.js";import"./evt-20927eae.js";import"./column-resize-5f24b124.js";import"./dx-style-helper-b4c313f5.js";const E=document.body,L=new WeakMap,D=new Map,M={subtree:!0,childList:!0},P=new MutationObserver((function(t){t.forEach(R)}));function R(t){t.removedNodes.forEach(S)}function S(t){const e=D.get(t);D.delete(t)&&(0===D.size&&P.disconnect(),e())}class T{constructor(t,e){this.element=t,this.getClientRect=e}get leftTopCorner(){const t=this;return new O(this.element,(function(e){return t.getClientRect(e)}),(function(t){return{x:0,y:0}}))}get leftBottomCorner(){const t=this;return new O(this.element,(function(e){const n=t.getClientRect(e);return new b(n.x,n.bottom)}),(function(e){const n=t.getClientRect(e);return new b(0,-n.height)}))}get rightTopCorner(){const t=this;return new O(this.element,(function(e){const n=t.getClientRect(e);return new b(n.right,n.y)}),(function(e){const n=t.getClientRect(e);return new b(-n.width,0)}))}get rightBottomCorner(){const t=this;return new O(this.element,(function(e){const n=t.getClientRect(e);return new b(n.right,n.bottom)}),(function(e){const n=t.getClientRect(e);return new b(-n.width,-n.height)}))}get center(){const t=this;return new O(this.element,(function(e){return t.getClientRect(e).center}))}}class O{constructor(t,e,n){this.element=t,this.getLocation=e,this.getDelta=n}get location(){return this.getLocation(this.element)}get delta(){return this.getDelta(this.element)}anchorTo(t){return new N(this,t)}}class N{constructor(t,e){this.point=t,this.anchor=e,this.events=new x(this);const n=[];if(n.push([window,"resize"]),n.push([window,"scroll"]),this.containers=function(t,e){const n=[];for(;null!==t&&"BODY"!==t.tagName&&"#document"!==t.nodeName;)e(t)&&n.push(t),t=t.parentNode;return 0===n.length?null:n}(this.anchor.element.parentNode,this.isElementScrollable),this.containers&&this.containers.forEach((function(t){n.push([t,"scroll"])})),this.checkInCasesInt(n),"undefined"!=typeof ResizeObserver){const t=this;this.resizeObserver=new window.ResizeObserver((function(){t.update()})),this.resizeObserver.observe(this.anchor.element),this.resizeObserver.observe(this.point.element)}else this.resizeObserver=null;let i=this.point.element.offsetParent;this.notStaticParent=null===i?{x:0,y:0,scrollTop:0,scrollLeft:0}:o(i)?i:window,this.update()}isElementScrollable(t){const e=window.getComputedStyle(t);return"static"===e.position&&("scroll"===e["overflow-x"]||"scroll"===e["overflow-y"]||"auto"===e["overflow-x"]||"auto"===e["overflow-y"])}update(){const t=this.notStaticParent===window?{x:window.scrollX,y:window.scrollY}:{x:this.notStaticParent.scrollLeft,y:this.notStaticParent.scrollTop},e=C(this.anchor.location,"+",this.point.delta,"-",this.notStaticParent,"+",t),n=this.point.element;i((function(){n.style.left=e.x+"px",n.style.top=e.y+"px"}))}checkInCasesInt(t){const e=this.events;t.forEach((function(t){e.attachEvent(t[0],t[1],(function(t){this.update()}))}))}checkInCases(){return this.containers?(this.checkInCasesInt(Array.from(arguments)),this.update(),this):this}dispose(){this.events&&(this.events.dispose(),this.events=null,this.dropDownStartPos=null,this.containers=null,this.resizeObserver&&this.resizeObserver.disconnect())}}function B(t){return new T(t,v)}function z(t){return new T(t,y)}var k;!function(t){t[t.Popup=0]="Popup",t[t.Modal=1]="Modal"}(k||(k={}));const j=window.console;var H;!function(t){t[t.Down=1]="Down",t[t.Up=2]="Up"}(H||(H={}));const I=new WeakMap;let W;const q=[];function F(t){let e=(t=s(t)).querySelector("div.dxbs-dm.dropdown-menu");return e||(e=t.querySelector("div.dxgvCSD.dxbs-grid-vsd")),e}function A(t,e,n,o){return new Promise(((n,i)=>{let r=F(t);r=s(r),r?(0===o&&(r.style.minWidth=t.offsetWidth+"px"),2===o&&(r.style.width=t.offsetWidth+"px"),U(t,r,e),f(r),n()):n()}))}function U(t,e,n){I.has(t)&&(I.get(t).disconnect(),I.delete(t));const o=e.offsetParent;if(!o)return void i((function(){e.style.visibility=""}));const s=o.getBoundingClientRect(),r=t.getBoundingClientRect(),c=r.top-s.top,l=s.bottom-r.bottom;let a;const u=window.getComputedStyle(e),d=e.offsetHeight+Math.max(parseFloat(u.marginTop),0)+Math.max(parseFloat(u.marginBottom),0)+8;switch(n){case H.Up:a=!0,s.top+(c-d)<=0&&s.top+c+t.offsetHeight+d+window.pageYOffset<=Math.max(document.body.scrollHeight,window.innerHeight)&&(a=!1);break;case H.Down:default:a=!1,s.bottom-(l-d)>=window.innerHeight&&s.top+c-d+window.pageYOffset>=0&&(a=!0);break}const h=r.left+e.offsetWidth+8>=document.body.clientWidth&&r.right-e.offsetWidth-8>0;i((()=>{W&&W.dispose(),W=a?h?B(e).rightBottomCorner.anchorTo(z(t).rightTopCorner):B(e).leftBottomCorner.anchorTo(z(t).leftTopCorner):h?B(e).rightTopCorner.anchorTo(z(t).rightBottomCorner):B(e).leftTopCorner.anchorTo(z(t).leftBottomCorner),e.style.visibility=""}))}const Y=[{value:0,text:""},{value:1,text:"above"},{value:2,text:"below"},{value:4,text:"top-sides"},{value:8,text:"bottom-sides"},{value:16,text:"outside-left"},{value:32,text:"outside-right"},{value:64,text:"left-sides"},{value:128,text:"right-sides"}];function V(t,e,n){let o=t.target;for(;o;){if(o===e)return;o=o.parentElement}n&&n()}function _(t){return"hidden"!==t.style.visibility||t.classList.contains("dxbs-visually-hidden")}const G="a[href], input:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex='-1'])";function K(t,e){if(!e)return!1;if(r(t.srcElement,"modal-header"))return!0;const n=r(t.srcElement,"column-chooser-elements-container"),o=r(n,"modal-body");if(!n||!o)return!1;if(o.clientHeight>=n.clientHeight)return!0;const i=t.touches[0].pageY-e.touches[0].pageY,s=t=>t.getBoundingClientRect().top,c=n.querySelector(".column-chooser-element-container");if(c&&s(c)===s(o)&&i>=0&&t.cancelable)return!0;const l=t=>Math.round(t.getBoundingClientRect().bottom),a=n.querySelector(".column-chooser-element-container:last-child");return a&&l(a)===l(o)&&i<=0&&t.cancelable}function X(t,e,n){if(n!==k.Modal)return-1;const o=t.getBoundingClientRect(),i=e.getBoundingClientRect(),s=r(t,"dxbs-gridview"),c=s&&s.querySelector("thead");if(!c)return-1;const l=c.getBoundingClientRect(),a=(l||o).bottom;return a>.5*e.clientHeight?a-o.top<.5*e.clientHeight?a-i.top-.5*e.clientHeight:o.top-i.top-2:-1}function J(t){if(!(t=s(t)))return;const e=t.getElementsByClassName("modal-body")[0];e.style.width=e.offsetWidth+"px",e.style.height=e.offsetHeight+"px"}const Q={init:function(t,e,o,i){if(t=s(t),e=s(e),o=s(o),!t)return Promise.reject("failed");if(d(t),o){const s=n=>{V(n,t,(function(){l(t)||d(t);const n=document.activeElement===e,s=o&&_(o);(n||s)&&i.invokeMethodAsync("OnDropDownLostFocus",e.value).catch((t=>j.error(t)))}))};document.addEventListener(n.touchMouseDownEventName,s),h(t,(function(){document.removeEventListener(n.touchMouseDownEventName,s)}))}return Promise.resolve("ok")},dispose:function(t){return(t=s(t))&&d(t),W&&W.dispose(),Promise.resolve("ok")},showAdaptiveDropdown:function(o,l,d,h,f,v){if(!(o=s(o)))return Promise.reject();const y=r(o,d);if(!y)return Promise.reject();const b=document.documentElement,x=document.documentElement.style.overflow,C=document.body.style.overflow,R=document.body.scroll,S=l.dialogType,T=l.alignment,O=S===k.Modal;if(S===k.Popup)0===T?U(y,o,l.dropDownDirection):m(o,y,function(t){let e="";return Y.forEach((n=>{0!=(n.value&t)&&(e&&(e+=" "),e+=n.text)})),e}(T));else{q.push(o),o.style.paddingRight=p(o)+g()+"px";const t=p(document.body)+g();document.body.style.paddingRight=String(t),document.body.classList.add("modal-open")}let N=!1;function B(t){const e=t.srcElement;o&&e&&(!o.contains(e)||S===k.Modal&&o===e)&&H(o)}function z(t){const e=t.target;e&&(b.removeEventListener("focusin",z),null===t.relatedTarget&&o&&o.contains(e)&&e.focus())}function H(t){if(!N){if(N=!0,a(t))return;I(),f.invokeMethodAsync("CloseDialog").catch((function(e){a(t)||j.error(e)}))}}function I(){if(b.removeEventListener(n.touchMouseDownEventName,B),window.removeEventListener("resize",F),S===k.Modal){if(o){const t=q.indexOf(o);t>-1&&q.splice(t,1)}q.length||(A(S,!1),document.body.classList.remove("modal-open"),document.body.style.paddingRight=String(p(document.body)-g()))}o=null}function W(){if(!o)return;const t=o.querySelector(G);t&&t.focus()}function F(){if(!o||!r(o,"modal-dialog-owner"))return;const t=o.firstElementChild;if(!t)return;const e=t.classList,n=X(y,b,S),i=b.clientHeight>b.clientWidth?"topVertical":"topHorizontal";u((function(){e.contains("topVertical")||e.contains("topHorizontal")?e.remove("transition"):e.add("transition"),n&&(b.scrollTop=n),e.remove("topVertical","topHorizontal"),e.add(i)}))}function A(t,e){if(t!==k.Modal)return;let n,o,i;e?(n="hidden",o="hidden",i=()=>{}):(n=x,o=C,i=R),document.documentElement.style.overflow=n,document.body.style.overflow=o,document.body.scroll=i}return b.addEventListener(n.touchMouseDownEventName,B),o.addEventListener("keydown",(function(t){o&&t.keyCode===e.KeyCode.Esc&&H(o)})),o.addEventListener("focusout",(function(t){const e=t.relatedTarget;!N&&o&&(e&&!o.contains(e)?function(t){if(!o)return;const e=o.compareDocumentPosition(t);e&window.Node.DOCUMENT_POSITION_PRECEDING?function(){if(!o)return;const t=function(t){const e=t.querySelectorAll(G);return e[e.length-1]}(o);t&&t.focus()}():e&window.Node.DOCUMENT_POSITION_FOLLOWING&&W()}(e):null===e&&b.addEventListener("focusin",z))})),function(t,e,n,o){t&&e.addEventListener("touchmove",(t=>{t.srcElement===e&&t.preventDefault()}));if(o===k.Modal){let t;n.addEventListener("touchstart",(e=>{t=e})),n.addEventListener("touchmove",(e=>{K(e,t)&&e.preventDefault(),t=e}))}}(O,o,y,S),function(t){if(L.has(t))return L.get(t);const e=new Promise((function(e){0===D.size&&P.observe(E,M),D.set(t,(()=>{e(void 0)}))}));return L.set(t,e),e}(o).then((()=>{I(),o=null})),A(S,!0),i((function(){o&&(l.showFocus||(t.addClassName(o,"dxbs-focus-hidden"),w(o)),S===k.Popup&&(W(),function(t,e){const n=r(t,e);if(t&&n){const e=r(t,"dx-menu-bar");e&&e.classList.contains("vertical")||(c(n,o),o())}function o(){const e=t.getBoundingClientRect(),o=n.getBoundingClientRect(),i=parseFloat(t.style.marginLeft);if(i&&(e.x=e.x-i),e.x+e.width>o.x+o.width&&o.width>e.width){const n=r(t.parentNode,"dropdown-menu");if(n){const o=n.getBoundingClientRect(),i=parseFloat(window.getComputedStyle(n,null).getPropertyValue("border-right-width"));t.style.marginLeft="-"+(e.x+e.width-o.x-i)+"px"}else t.style.marginLeft="-"+(e.x+e.width-o.x-o.width)+"px"}else i&&(t.style.marginLeft="")}}(o,v)))})),S===k.Modal&&(window.addEventListener("resize",F),F()),Promise.resolve()},updateGridDropDown:A,setInlineModalSize:J};export default Q;export{k as DialogType,F as getDropDownElement,_ as isDropDownVisible,V as onOutsideClick,X as scrollDropDown,J as setInlineModalSize,U as setPositionOfDropDown,K as shouldPreventTouchMove,A as updateGridDropDown};
