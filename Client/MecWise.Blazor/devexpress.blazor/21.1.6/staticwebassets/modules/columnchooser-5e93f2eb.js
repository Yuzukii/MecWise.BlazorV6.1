import{A as e}from"./dom-utils-69ea39c0.js";import{F as n,D as t,a as o,R as r,E as s}from"./dragAndDropUnit-e1f6550e.js";import"./dom-a06f5987.js";import"./touch-2ca1b361.js";let i,c,u,f,l,d,a,p,_,m,v=null,h=-1,x=-1,g=!0,w=!1;function y(e,n,t,o){const r=Array.from(n).map((e=>function(e){const n=e.clientRef;return n._dx_server_ref=e.serverRef,n}(e)));if(f?f._id!==o._id&&(B(f),f=o):f=o,!p){p=e;let n=p;for(;n.parentNode!==document&&n.classList;){if(n.classList.contains("modal-body")){w=!0;break}n=n.parentNode}}if(l=new Map,d&&d.dispose(),d=new s(p),v||(c=new Map,u=new Map,v=r),x=-1,d.attachEventWithContext(document,"keydown",b,document),v&&(_=function(e,n){if(w)return e;let t=e,o=window.getComputedStyle(t);for(;o.position!==n&&t.parentNode!==document;)t=t.parentNode,o=window.getComputedStyle(t);return t}(p,"absolute"),E(t&&!w),L())){const e=d.attachEvent(_,"focusin",(function(){e.dispose(),v[0].focus()}))}j(),m&&(m.parentNode.removeChild(m),m=null)}function E(e){g=e,a&&a.dispose();const o=document.querySelector(".column-chooser-exit-button");a=o?new n(o,null,p,!g):null,u.forEach((function(e){e.dispose()})),u=new Map,v.forEach((function(e){!function(e,o){let r=c.get(e._dx_server_ref);r||(r=new t(e,e.parentNode,M,".column-chooser-drag-icon-owner",F,w),r.onDragStart=A,r.onDrag=q,r.onDragCancel=R,r.onDropAnimationEnd=z,c.set(e._dx_server_ref,r));r.reset(),e.classList.remove("up"),e.classList.remove("down"),e.classList.remove("freeze");let s=u.get(e._dx_server_ref);s||(s=new n(e,".custom-control-input",o,w||!g),s.onFocus=C,s.onBlur=D,s.onClick=k,u.set(e._dx_server_ref,s));s.reset()}(e,_)}))}function L(){return g}function b(e){switch(L()||(E(!0),9===e.keyCode&&v[v.length-1].focus()),e.keyCode){case 32:x>=0&&(e.preventDefault(),v[x].click());break;case 38:e.preventDefault(),N(-1);break;case 40:e.preventDefault(),N(1)}}function N(e){if(!v||!c)return;x+=e,x=x<0?v.length-1:x,x%=v.length;const n=u.get(v[x]._dx_server_ref);n&&n.focus()}function C(e){x=v.indexOf(e)}function D(e){x===v.indexOf(e)&&(x===v.length-1&&a&&a.focus(),x=-1)}function k(e){L()&&E(!1)}function O(e){return v.find((function(n,t,o){return function(e,n){const t=S(e);return!!t&&(t.top<=n&&n<=t.bottom)}(n,e.y)}))}function M(e){const n=O(e);return n?{item:n,relativeRect:S(n)}:null}function j(){if(i&&i.style){const e=c.get(i._dx_server_ref);e&&e.reset();const n=u.get(i._dx_server_ref);n&&n.reset(),h=-1,i.childNodes.forEach((function(e){e.style&&(e.style.visibility="")})),i=null}}function A(e){i=e,h=v.indexOf(i),v.forEach((function(e){e.blur(),e!==i&&e.classList.add("freeze")})),i.childNodes.forEach((function(e){e.style&&(e.style.visibility="hidden")}));const n=u.get(i._dx_server_ref);n&&n.stop()}function S(e){let n=l.get(e);if(n)return n;const t=o(e),s=F();return n=new r(t.x-s.x,t.y-s.y,t.width,t.height),l.set(e,n),n}function z(n,t){v.forEach((function(e){c.get(e._dx_server_ref).stop()})),m=p.cloneNode(!0),e(m),m.style["z-index"]=2e3,p.parentNode.appendChild(m),f.invokeMethodAsync("OnElementsExchange",n._dx_server_ref,t._dx_server_ref).catch((function(e){window.console.error(e)}))}function R(e){v.forEach((function(e){e.classList.remove("up"),e.classList.remove("down"),e.classList.remove("freeze")})),j()}function F(){const e=w?p.parentNode:p,n=o(e);return 0!==e.scrollTop?{x:n.x,y:n.y-e.scrollTop}:n.location}function T(e){u.get(e._dx_server_ref).updateStyleMetadata()}function q(e,n){if(!e)return;-1===h&&(h=v.indexOf(e));const t=O(n.centerOfDraggingObject);if(!t)return;const o=v.indexOf(t);let r=!1;v.forEach(h<o?function(e){i===e&&(r=!0),r?(T(e),e.classList.add("up")):e.classList.remove("up","down"),t===e&&(r=!1)}:h>o?function(e){t===e&&(r=!0),r?(T(e),e.classList.add("down")):e.classList.remove("up","down"),i===e&&(r=!1)}:function(e){e.classList.remove("up","down")})}function B(e){e._id===f._id&&(e.dispose(),c.forEach((function(e){e.dispose()})),u.forEach((function(e){e.dispose()})),v&&v.forEach((function(e){e._dx_server_ref.dispose()})),v=null,i=null,h=-1,p=null,l=null,c=null,u=null,f=null,d&&d.dispose(),d=null,m&&(m.parentNode.removeChild(m),m=null))}const U={init:y,dispose:B};export default U;export{B as dispose,y as init};
